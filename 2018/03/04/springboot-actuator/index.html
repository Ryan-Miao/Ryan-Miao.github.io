<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringCloud入门2-Springboot监控模块(actuator) | Ryan Miao的博客</title><meta name="keywords" content="SpringCloud,监控,actuator"><meta name="author" content="Ryan Miao"><meta name="copyright" content="Ryan Miao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="前言学习一项新技术最大的困难是什么？ 是资料。让人高兴的是找到了一本系统学习Spring Cloud的教程，《Spring Cloud微服务实战》, 接下来的学习目标将以此书顺序演进。 虽然Springboot 2.0刚刚发布，鉴于当下资料都是基于1.x的，对于初学者，站在前人的肩膀上会少踩坑。因此，接下来都将采用1.5.10.RELEASE。 上一节，SpringCloud入门1-服务注册与发现">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringCloud入门2-Springboot监控模块(actuator)">
<meta property="og:url" content="http://blog.rmiao.top/2018/03/04/springboot-actuator/index.html">
<meta property="og:site_name" content="Ryan Miao的博客">
<meta property="og:description" content="前言学习一项新技术最大的困难是什么？ 是资料。让人高兴的是找到了一本系统学习Spring Cloud的教程，《Spring Cloud微服务实战》, 接下来的学习目标将以此书顺序演进。 虽然Springboot 2.0刚刚发布，鉴于当下资料都是基于1.x的，对于初学者，站在前人的肩膀上会少踩坑。因此，接下来都将采用1.5.10.RELEASE。 上一节，SpringCloud入门1-服务注册与发现">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg">
<meta property="article:published_time" content="2018-03-04T15:44:59.000Z">
<meta property="article:modified_time" content="2020-11-10T13:25:51.148Z">
<meta property="article:author" content="Ryan Miao">
<meta property="article:tag" content="SpringCloud">
<meta property="article:tag" content="监控">
<meta property="article:tag" content="actuator">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://blog.rmiao.top/2018/03/04/springboot-actuator/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2020-11-10 21:25:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">92</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">60</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">42</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ryan Miao的博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">SpringCloud入门2-Springboot监控模块(actuator)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2018-03-04T15:44:59.000Z" title="Created 2018-03-04 23:44:59">2018-03-04</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-11-10T13:25:51.148Z" title="Updated 2020-11-10 21:25:51">2020-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SpringCloud/">SpringCloud</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>学习一项新技术最大的困难是什么？ 是资料。让人高兴的是找到了一本系统学习Spring Cloud的教程，《Spring Cloud微服务实战》, 接下来的学习目标将以此书顺序演进。</p>
<p>虽然Springboot 2.0刚刚发布，鉴于当下资料都是基于1.x的，对于初学者，站在前人的肩膀上会少踩坑。因此，接下来都将采用<code>1.5.10.RELEASE</code>。</p>
<p>上一节，<a href="">SpringCloud入门1-服务注册与发现(Eureka)</a> 中已经尝试使用了<code>spring-boot-starter-actuator</code>模块中的健康检查端点，接下来将系统的学习该模块的功能。</p>
<blockquote>
<p>Spring Boot includes a number of additional features to help you monitor and manage your application when it’s pushed to production. You can choose to manage and monitor your application using HTTP endpoints, with JMX or even by remote shell (SSH or Telnet). Auditing, health and metrics gathering can be automatically applied to your application.</p>
</blockquote>
<a id="more"></a>



<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>测试代码： <a target="_blank" rel="noopener" href="https://github.com/Ryan-Miao/actuator-demo">https://github.com/Ryan-Miao/actuator-demo</a></p>
<p>如同上一节中所引入的方式一样。创建一个springboot项目，并添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>actuator 美 [‘æktʃʊˌeɪtə]</p>
<p>接下来，启动项目。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::       (v1.5.10.RELEASE)</span><br><span class="line"></span><br><span class="line">2018-03-04 12:15:52.611  INFO 18468 --- [           main] com.test.actuator.ActuatorApplication    : Starting ActuatorApplication on DESKTOP-4MOUU2Q with PID 18468 (D:\workspace\learn\springcloud\actuator-demo\target\classes started by Ryan in D:\workspace\learn\springcloud\actuator-demo)</span><br><span class="line">2018-03-04 12:15:52.615  INFO 18468 --- [           main] com.test.actuator.ActuatorApplication    : No active profile set, falling back to default profiles: default</span><br><span class="line">2018-03-04 12:15:52.709  INFO 18468 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@1efee8e7: startup date [Sun Mar 04 12:15:52 CST 2018]; root of context hierarchy</span><br><span class="line">2018-03-04 12:15:55.125  INFO 18468 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2018-03-04 12:15:55.140  INFO 18468 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2018-03-04 12:15:55.140  INFO 18468 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat&#x2F;8.5.27</span><br><span class="line">2018-03-04 12:15:55.265  INFO 18468 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2018-03-04 12:15:55.265  INFO 18468 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 2588 ms</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean  : Mapping servlet: &#39;dispatcherServlet&#39; to [&#x2F;]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;metricsFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;characterEncodingFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;hiddenHttpMethodFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;httpPutFormContentFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;requestContextFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;webRequestLoggingFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.512  INFO 18468 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean   : Mapping filter: &#39;applicationContextIdFilter&#39; to: [&#x2F;*]</span><br><span class="line">2018-03-04 12:15:55.926  INFO 18468 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@1efee8e7: startup date [Sun Mar 04 12:15:52 CST 2018]; root of context hierarchy</span><br><span class="line">2018-03-04 12:15:56.004  INFO 18468 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[&#x2F;error]&#125;&quot; onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)</span><br><span class="line">2018-03-04 12:15:56.004  INFO 18468 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &quot;&#123;[&#x2F;error],produces&#x3D;[text&#x2F;html]&#125;&quot; onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)</span><br><span class="line">2018-03-04 12:15:56.051  INFO 18468 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [&#x2F;webjars&#x2F;**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2018-03-04 12:15:56.051  INFO 18468 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [&#x2F;**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2018-03-04 12:15:56.097  INFO 18468 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [&#x2F;**&#x2F;favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;env&#x2F;&#123;name:.*&#125;],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EnvironmentMvcEndpoint.value(java.lang.String)</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;env || &#x2F;env.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;info || &#x2F;info.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;health || &#x2F;health.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.HealthMvcEndpoint.invoke(javax.servlet.http.HttpServletRequest,java.security.Principal)</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;mappings || &#x2F;mappings.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;trace || &#x2F;trace.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.387  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;dump || &#x2F;dump.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;loggers&#x2F;&#123;name:.*&#125;],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.LoggersMvcEndpoint.get(java.lang.String)</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;loggers&#x2F;&#123;name:.*&#125;],methods&#x3D;[POST],consumes&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.LoggersMvcEndpoint.set(java.lang.String,java.util.Map&lt;java.lang.String, java.lang.String&gt;)</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;loggers || &#x2F;loggers.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;autoconfig || &#x2F;autoconfig.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;metrics&#x2F;&#123;name:.*&#125;],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.MetricsMvcEndpoint.value(java.lang.String)</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;metrics || &#x2F;metrics.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;auditevents || &#x2F;auditevents.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public org.springframework.http.ResponseEntity&lt;?&gt; org.springframework.boot.actuate.endpoint.mvc.AuditEventsMvcEndpoint.findByPrincipalAndAfterAndType(java.lang.String,java.util.Date,java.lang.String)</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;configprops || &#x2F;configprops.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;beans || &#x2F;beans.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;vnd.spring-boot.actuator.v1+json || application&#x2F;json]&#125;&quot; onto public java.lang.Object org.springframework.boot.actuate.endpoint.mvc.EndpointMvcAdapter.invoke()</span><br><span class="line">2018-03-04 12:15:56.403  INFO 18468 --- [           main] o.s.b.a.e.mvc.EndpointHandlerMapping     : Mapped &quot;&#123;[&#x2F;heapdump || &#x2F;heapdump.json],methods&#x3D;[GET],produces&#x3D;[application&#x2F;octet-stream]&#125;&quot; onto public void org.springframework.boot.actuate.endpoint.mvc.HeapdumpMvcEndpoint.invoke(boolean,javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse) throws java.io.IOException,javax.servlet.ServletException</span><br><span class="line">2018-03-04 12:15:56.512  INFO 18468 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup</span><br><span class="line">2018-03-04 12:15:56.512  INFO 18468 --- [           main] o.s.c.support.DefaultLifecycleProcessor  : Starting beans in phase 0</span><br><span class="line">2018-03-04 12:15:56.747  INFO 18468 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)</span><br><span class="line">2018-03-04 12:15:56.747  INFO 18468 --- [           main] com.test.actuator.ActuatorApplication    : Started ActuatorApplication in 4.615 seconds (JVM running for 5.11)</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>可以看到url mapping多了几个。接下来，分别看看这几个接口的内容。</p>
<p>访问这几个接口的时候发现啥也没有，然后看到控制台提示，这些敏感信息需要加密。所以，必须引入security模块。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-security&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>设置用户名密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">security.user.name&#x3D;admin</span><br><span class="line">security.user.password&#x3D;123456</span><br></pre></td></tr></table></figure>


<p>然后，重启，访问<a target="_blank" rel="noopener" href="http://localhost:8080/health">http://localhost:8080/health</a> 得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: &quot;UP&quot;,</span><br><span class="line">    &quot;diskSpace&quot;: &#123;</span><br><span class="line">        &quot;status&quot;: &quot;UP&quot;,</span><br><span class="line">        &quot;total&quot;: 126702579712,</span><br><span class="line">        &quot;free&quot;: 71547412480,</span><br><span class="line">        &quot;threshold&quot;: 10485760</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="端点endpoint"><a href="#端点endpoint" class="headerlink" title="端点endpoint"></a>端点endpoint</h2><p>Actuator endpoints可以让我们监控和与我们的应用(application)交互。Spring Boot actuator包含了大量的内置endpoints， 当然，我们也可以添加我们自己的。</p>
<p>如何暴露端口取决与你采用的技术。大多数应用采用HTTP监控，这时，endpoint的ID就映射为一个接口URL。比如，默认<code>health</code>映射为<code>/health</code>. (2.0貌似不是这样，后面再看)</p>
<p>自带的内置endpoint大概有这些(sensitive是指需要密码)：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Description</th>
<th>Sensitive Default</th>
</tr>
</thead>
<tbody><tr>
<td>actuator</td>
<td>提供端点基本信息，”discovery page”</td>
<td>true</td>
</tr>
<tr>
<td>auditevents</td>
<td>提供审计事件信息</td>
<td>true</td>
</tr>
<tr>
<td>autoconfig</td>
<td>提供auto-configuration报告，显示所有的自动配置项以及生效和不生效的原因</td>
<td>true</td>
</tr>
<tr>
<td>beans</td>
<td>显示应用中所有的bean</td>
<td>true</td>
</tr>
<tr>
<td>configprops</td>
<td>显示整理过的<code>@ConfigurationProperties</code></td>
<td>true</td>
</tr>
<tr>
<td>dump</td>
<td>显示线程dump信息</td>
<td>true</td>
</tr>
<tr>
<td>env</td>
<td>显示Spring的<code>ConfigurableEnvironment</code>属性</td>
<td>true</td>
</tr>
<tr>
<td>flyway</td>
<td>显示应用的所有Flyway database迁移</td>
<td>true</td>
</tr>
<tr>
<td>health</td>
<td>显示系统健康状态(登陆后显示详细信息)</td>
<td>false</td>
</tr>
<tr>
<td>info</td>
<td>显示一些自定义信息</td>
<td>false</td>
</tr>
<tr>
<td>loggers</td>
<td>显示和更改应用的logger配置</td>
<td>true</td>
</tr>
<tr>
<td>liquibase</td>
<td>显示所有的Liquibase database迁移</td>
<td>true</td>
</tr>
<tr>
<td>metrics</td>
<td>显示当前的metrics信息</td>
<td>true</td>
</tr>
<tr>
<td>mappings</td>
<td>显示所有<code>@RequestMapping</code></td>
<td>true</td>
</tr>
<tr>
<td>shutdown</td>
<td>允许应用程序正常关机（默认情况下未启用）。</td>
<td>true</td>
</tr>
<tr>
<td>trace</td>
<td>显示跟踪信息（默认情况下是最近的100个HTTP请求）</td>
<td>true</td>
</tr>
</tbody></table>
<p>如果是Spring MVC, 还有以下几个：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Description</th>
<th>Sensitive  Default</th>
</tr>
</thead>
<tbody><tr>
<td>docs</td>
<td>显示actuator的文档。需要引入<code>spring-boot-actuator-docs</code></td>
<td>false</td>
</tr>
<tr>
<td>heapdump</td>
<td>返回<code>hprof</code> 文件</td>
<td>true</td>
</tr>
<tr>
<td>jolokia</td>
<td>通过HTTP公开JMX bean（当Jolokia位于类路径中时）。</td>
<td>true</td>
</tr>
<tr>
<td>logfile</td>
<td>返回日志文件的内容（如果logging.file或logging.path属性已设置）。支持使用HTTP范围头来检索部分日志文件的内容。</td>
<td>true</td>
</tr>
</tbody></table>
<p>根据endpoint的作用，可以将原生endpoint分为3类</p>
<ol>
<li>应用配置类： 获取应用程序中加载的应用配置、环境变量、自动化配置报告等与Spring Boot应用密切相关的配置类信息。</li>
<li>度量指标类： 获取应用程序运行过程中用于监控的度量指标，比如内存信息、线程池信息、HTTP请求统计等。</li>
<li>操作控制类：提供对应用的关闭等操作类功能。</li>
</ol>
<h3 id="应用配置类"><a href="#应用配置类" class="headerlink" title="应用配置类"></a>应用配置类</h3><p>由于Spring Boot为了改善传统Spring应用复杂的配置，采用了包扫描和自动化配置机制来加载原来集中与XML的内容。虽然这样做让我们代码变得简洁，但整个应用的实例创建和依赖关系等信息都被离散到了各个配置类的注解上。这使我们分析整个应用中资源和实例的各种关系变得非常困难。而这类endpoint可以帮助我们轻松获取一系列关于Spring配置内容的详细报告，比如自动化配置的报告、Bean创建的报告、环境属性的报告等。</p>
<p><code>/env</code>: 对于密码属性，属性名中包含password、secret、key这些关键词，会返回**代替value。</p>
<p><code>/info</code>: 自定义</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">info.app.name&#x3D;spring boot demo</span><br><span class="line">info.app.version&#x3D;1.0</span><br></pre></td></tr></table></figure>






<h3 id="度量指标类"><a href="#度量指标类" class="headerlink" title="度量指标类"></a>度量指标类</h3><p><code>/metrics</code>: 返回内存信息、线程信息、垃圾回收信息等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;mem&quot;: 437985,</span><br><span class="line">    &quot;mem.free&quot;: 342068,</span><br><span class="line">    &quot;processors&quot;: 4,</span><br><span class="line">    &quot;instance.uptime&quot;: 19821025,</span><br><span class="line">    &quot;uptime&quot;: 19812936,</span><br><span class="line">    &quot;systemload.average&quot;: -1,</span><br><span class="line">    &quot;heap.committed&quot;: 382464,</span><br><span class="line">    &quot;heap.init&quot;: 131072,</span><br><span class="line">    &quot;heap.used&quot;: 40395,</span><br><span class="line">    &quot;heap&quot;: 1846272,</span><br><span class="line">    &quot;nonheap.committed&quot;: 56848,</span><br><span class="line">    &quot;nonheap.init&quot;: 2496,</span><br><span class="line">    &quot;nonheap.used&quot;: 55521,</span><br><span class="line">    &quot;nonheap&quot;: 0,</span><br><span class="line">    &quot;threads.peak&quot;: 25,</span><br><span class="line">    &quot;threads.daemon&quot;: 21,</span><br><span class="line">    &quot;threads.totalStarted&quot;: 28,</span><br><span class="line">    &quot;threads&quot;: 23,</span><br><span class="line">    &quot;classes&quot;: 6792,</span><br><span class="line">    &quot;classes.loaded&quot;: 6843,</span><br><span class="line">    &quot;classes.unloaded&quot;: 51,</span><br><span class="line">    &quot;gc.ps_scavenge.count&quot;: 8,</span><br><span class="line">    &quot;gc.ps_scavenge.time&quot;: 98,</span><br><span class="line">    &quot;gc.ps_marksweep.count&quot;: 3,</span><br><span class="line">    &quot;gc.ps_marksweep.time&quot;: 322,</span><br><span class="line">    &quot;httpsessions.max&quot;: -1,</span><br><span class="line">    &quot;httpsessions.active&quot;: 0,</span><br><span class="line">    &quot;gauge.response.actuator&quot;: 224,</span><br><span class="line">    &quot;gauge.response.loggers&quot;: 23,</span><br><span class="line">    &quot;gauge.response.env&quot;: 12,</span><br><span class="line">    &quot;gauge.response.docs.star-star&quot;: 19,</span><br><span class="line">    &quot;gauge.response.autoconfig&quot;: 67,</span><br><span class="line">    &quot;gauge.response.trace&quot;: 17,</span><br><span class="line">    &quot;gauge.response.metrics&quot;: 8,</span><br><span class="line">    &quot;gauge.response.heapdump.root&quot;: 2656,</span><br><span class="line">    &quot;gauge.response.docs&quot;: 3,</span><br><span class="line">    &quot;gauge.response.configprops&quot;: 167,</span><br><span class="line">    &quot;gauge.response.star-star&quot;: 8,</span><br><span class="line">    &quot;counter.status.302.docs&quot;: 2,</span><br><span class="line">    &quot;counter.status.200.actuator&quot;: 1,</span><br><span class="line">    &quot;counter.status.200.loggers&quot;: 1,</span><br><span class="line">    &quot;counter.status.200.docs.star-star&quot;: 4,</span><br><span class="line">    &quot;counter.status.200.metrics&quot;: 2,</span><br><span class="line">    &quot;counter.status.200.configprops&quot;: 1,</span><br><span class="line">    &quot;counter.status.404.star-star&quot;: 5,</span><br><span class="line">    &quot;counter.status.200.autoconfig&quot;: 1,</span><br><span class="line">    &quot;counter.status.200.heapdump.root&quot;: 1,</span><br><span class="line">    &quot;counter.status.200.env&quot;: 1,</span><br><span class="line">    &quot;counter.status.200.trace&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>系统信息：包括处理器数量processors，运行时间uptime和instance.uptime,系统平均负载systemload.average.</li>
<li>mem.*: 内存概要信息。包括分配给应用的总内存数量以及当前空闲的内存数量。这些信息来自java.lang.Runtime。</li>
<li>heap.*: 堆内存使用情况。 这些信息来自 java.lang.management.MemoryMXBean 接口中 getHeapMemoryUsage 方法获取的 java.lang.management.MemoryUsage。</li>
<li>nonheap. *: 非堆内存使用情况。 这些信息来自 java.lang.management.MemoryMXBean接口中ge七NonHeapMemoryUsage方法获取的java.lang.managemen七.MemoryUsage。</li>
<li>threads.*: 线程使用情况，包括线程数、守护线程数(daemon汃线程峰值(peak)等，这些数据均来自java.lang.management.ThreadMXBean。</li>
<li>classes.*: 应用加载和卸载的类统计。这些数据均来自java.lang.management．ClassLoadingMXBean。</li>
<li>gc. *: 垃圾收集器的详细信息，包括垃圾回收次数gc.ps—scavenge.count、垃圾回收消耗时间 gc.ps _ scavenge.time、 标记－清除算法的次数 gc.psmarksweep.count、 标记－清除算法的消耗时间gc.ps_marksweep.time。这些数据均来自java.lang.managemen七.GarbageCollectorMXBean。</li>
<li>httpsessions. * : Tomcat容 器 的会话使用情况。包括最大会话数httpsessions.max和活跃会话数httpsessions.ac巨ve。 该度量指标信息仅在引入嵌入式Tomcat作为应用容器的时候才会提供。</li>
<li>gauge.*: HTTP请求的性能指标之 一 ，它主要用来反映 一 个绝对数值。 比如上面示例中的gauge.response.hello: 5, 它表示上一次hello请求的延迟时间为5毫秒。</li>
<li>counter.*: HTTP 请求的性能指标之 一 ，它主要作为计 数器来使用，记录了增加量和减少量。 上述示例中的counter.s七红us.200.hello: 11, 它代表了 hello请求返回200状态的次数为11。</li>
</ol>
<p>对于gauge.*和counter.*的统计， 这里有一 个特殊的内容请求 star-star,它代表了对静态资源的访问。 这两类度量指标非常有用，我们不仅可以使用它默认的统计指标，还可以在程序中轻松地增加自定义 统计 值。只需要通过注org.springframework.boot.actuate.metrics.CounterService和org.springframework.boot.actuate.metrics.GaugeService 来实现自定义的统计指标信息。比如我们可以像下面这样自定义实现对hello接口的访问次数统计。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier(&quot;counterService&quot;)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CounterService counterService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;hello&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        counterService.increment(<span class="string">&quot;test.hello.count&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> counterService.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>/metrics端点可以提供应用运行状态的完整度量指标报告，这项功能 非常实用，但是对千监控系 统中的各项监控功能，它们的监控内容、 数据收集频率都有所不同，如果每次都通过全量获取报告的方式来收集，略显粗暴。 所以，我们还可以通过/metrics/{name}接口来更细粒度地获取度量信息 ， 比如可以通过访问/metrics/mem.free来获取当前可用内存数量。</p>
<p>/health:  在spring-boot-s七arter-ac七uator模块中自带实现了一 些常用资源的健康指标检测器。这些检测器 都通过Hea巨hindicator接口实现，并且会根据依赖关系的引入实现自动化装配， 比如下面列出的这些。</p>
<p>CassandraHealthIndicator，DiskSpaceHealthIndicator，DataSourceHealthIndicator，ElasticsearchHealthIndicator，JmsHealthIndicator，MailHealthIndicator，MongoHealthIndicator，RabbitHealthIndicator，RedisHealthIndicator，SolrHealthIndicator</p>
<p>可以通过<code>management.health.defaults.enabled</code>来控制上述健康检查是否生效。</p>
<p>也可以自定义，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RocketMQHealthIndicator</span> <span class="keyword">implements</span> <span class="title">HealthIndicator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Health <span class="title">health</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> errorCode = check();</span><br><span class="line">        <span class="keyword">if</span> (errorCode != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Health.down().withDetail(<span class="string">&quot;Error Code&quot;</span>, errorCode).build();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Health.up().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 自定义健康检查</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






<p> /dump:  该端点用来暴露程序运行中的线程信息。它使用 java.lang.rnanagernent.ThreadMXBean 的 durnpAllThreads 方法来返回所有含有同步信息的活动线程详情。</p>
<p>/trace:  该端点用来返回基本的 HTTP 跟踪信息。 默认情况下， 跟踪信息的存储采用org.springfrarnework.boo七.ac七uate.trace.InMernoryTraceRepository实现的内存方式， 默认始终保留最近的100条请求记录。</p>
<h2 id="修改endpoint配置"><a href="#修改endpoint配置" class="headerlink" title="修改endpoint配置"></a>修改endpoint配置</h2><p>上述的自带属性可以通过配置文件修改默认配置。key前缀为<code>endpoints.*</code></p>
<p>比如，修改<code>beans</code>和<code>shutdown</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">endpoints.beans.id&#x3D;springbeans</span><br><span class="line">endpoints.beans.sensitive&#x3D;false</span><br><span class="line">endpoints.shutdown.enabled&#x3D;true</span><br></pre></td></tr></table></figure>


<p>默认所有的endpoint可用，除了<code>shutdown</code>。当然，可以是全部关闭，然后单独打开。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">endpoints.enabled&#x3D;false</span><br><span class="line">endpoints.info.enabled&#x3D;true</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>可以设置全局属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">endpoints.sensitive&#x3D;true</span><br><span class="line">endpoints.info.sensitive&#x3D;false</span><br></pre></td></tr></table></figure>






<h2 id="设置跨域"><a href="#设置跨域" class="headerlink" title="设置跨域"></a>设置跨域</h2><p>如果想在别的域名下调用，则需要设置允许跨域。当然可以自己手动写跨域拦截。但actuator也提供了配置文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">endpoints.cors.allowed-origins&#x3D;http:&#x2F;&#x2F;example.com</span><br><span class="line">endpoints.cors.allowed-methods&#x3D;GET,POST</span><br></pre></td></tr></table></figure>




<h2 id="添加自定义endpoint"><a href="#添加自定义endpoint" class="headerlink" title="添加自定义endpoint"></a>添加自定义endpoint</h2><p>配置<code>@Bean</code>的<code>Endpoint</code>对象即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Endpoint <span class="title">myEndpoint</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> Endpoint&lt;Map&lt;String,Object&gt;&gt;() &#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">&quot;my-endpoint&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSensitive</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">invoke</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">final</span> Map&lt;String, Object&gt; dataToDisplay = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">			dataToDisplay.put(<span class="string">&quot;some&quot;</span>, <span class="string">&quot;thing&quot;</span>);</span><br><span class="line">			dataToDisplay.put(<span class="string">&quot;you&quot;</span>, <span class="string">&quot;want&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> dataToDisplay;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#production-ready">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#production-ready</a></li>
<li>《Spring Cloud微服务实战》</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Ryan Miao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://blog.rmiao.top/2018/03/04/springboot-actuator/">http://blog.rmiao.top/2018/03/04/springboot-actuator/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringCloud/">SpringCloud</a><a class="post-meta__tags" href="/tags/%E7%9B%91%E6%8E%A7/">监控</a><a class="post-meta__tags" href="/tags/actuator/">actuator</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2018/03/16/jvm-garbage/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">深入理解JVM垃圾收集机制(JDK1.8)</div></div></a></div><div class="next-post pull-right"><a href="/2018/03/03/springcloud-eureka/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">SpringCloud入门1-服务注册与发现(Eureka)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2018/03/01/consul-install/" title="consul安装使用"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-03-01</div><div class="title">consul安装使用</div></div></a></div><div><a href="/2018/07/04/springcloud-provider/" title="SpringCloud学习5-如何创建一个服务提供者provider"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-04</div><div class="title">SpringCloud学习5-如何创建一个服务提供者provider</div></div></a></div><div><a href="/2018/06/14/springcloud2-eureka/" title="SpringCloud2.0入门3-新的eureka依赖"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-14</div><div class="title">SpringCloud2.0入门3-新的eureka依赖</div></div></a></div><div><a href="/2018/07/04/springcloud-consumer/" title="SpringCloud学习6-如何创建一个服务消费者consumer"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-04</div><div class="title">SpringCloud学习6-如何创建一个服务消费者consumer</div></div></a></div><div><a href="/2018/06/14/springcloud2-admin/" title="SpringCloud2.0入门4-springboot-admin监控"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-06-14</div><div class="title">SpringCloud2.0入门4-springboot-admin监控</div></div></a></div><div><a href="/2018/03/03/springcloud-eureka/" title="SpringCloud入门1-服务注册与发现(Eureka)"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-03-03</div><div class="title">SpringCloud入门1-服务注册与发现(Eureka)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">Ryan Miao</div><div class="author-info__description">技术总结</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">92</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">60</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">42</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ryan-miao" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:woshimrf@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">2.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E7%82%B9endpoint"><span class="toc-number">3.</span> <span class="toc-text">端点endpoint</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">3.1.</span> <span class="toc-text">应用配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%A6%E9%87%8F%E6%8C%87%E6%A0%87%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">度量指标类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9endpoint%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">修改endpoint配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%B7%A8%E5%9F%9F"><span class="toc-number">5.</span> <span class="toc-text">设置跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89endpoint"><span class="toc-number">6.</span> <span class="toc-text">添加自定义endpoint</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">7.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2020/11/11/java-synchronized/" title="Java基础之Synchronized原理"><img src="https://cn.bing.com/th?id=OHR.EsskastanieD_ZH-CN9736686128_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=2880&amp;h=1620&amp;rs=1&amp;c=4" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java基础之Synchronized原理"/></a><div class="content"><a class="title" href="/2020/11/11/java-synchronized/" title="Java基础之Synchronized原理">Java基础之Synchronized原理</a><time datetime="2020-11-11T12:46:40.000Z" title="Created 2020-11-11 20:46:40">2020-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/10/java-class-inheritance/" title="Java复习3-类的继承"><img src="https://cn.bing.com/th?id=OHR.LakotaBadlands_ZH-CN0151830089_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=2880&amp;h=1620&amp;rs=1&amp;c=4" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java复习3-类的继承"/></a><div class="content"><a class="title" href="/2018/07/10/java-class-inheritance/" title="Java复习3-类的继承">Java复习3-类的继承</a><time datetime="2018-07-10T11:58:14.000Z" title="Created 2018-07-10 19:58:14">2018-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/07/java-class/" title="Java复习2-对象与类"><img src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java复习2-对象与类"/></a><div class="content"><a class="title" href="/2018/07/07/java-class/" title="Java复习2-对象与类">Java复习2-对象与类</a><time datetime="2018-07-07T07:27:14.000Z" title="Created 2018-07-07 15:27:14">2018-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/06/java-data-type/" title="Java复习1-数据类型"><img src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java复习1-数据类型"/></a><div class="content"><a class="title" href="/2018/07/06/java-data-type/" title="Java复习1-数据类型">Java复习1-数据类型</a><time datetime="2018-07-06T09:03:26.000Z" title="Created 2018-07-06 17:03:26">2018-07-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/04/springcloud-consumer/" title="SpringCloud学习6-如何创建一个服务消费者consumer"><img src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud学习6-如何创建一个服务消费者consumer"/></a><div class="content"><a class="title" href="/2018/07/04/springcloud-consumer/" title="SpringCloud学习6-如何创建一个服务消费者consumer">SpringCloud学习6-如何创建一个服务消费者consumer</a><time datetime="2018-07-04T11:44:12.000Z" title="Created 2018-07-04 19:44:12">2018-07-04</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By Ryan Miao</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk({
      clientID: '50b74dddd9c8deff00e9',
      clientSecret: 'b61654c092fbd8ab7ff6c4d0078b671b62211e23',
      repo: 'gitalk',
      owner: 'ryanmiao2',
      admin: ['ryanmiao2'],
      id: '740918c17c9aa8d825055374ba64a1fa',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    })
    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    $.getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js', initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>