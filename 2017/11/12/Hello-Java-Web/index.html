<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Java Web基础入门 | Ryan Miao的博客</title><meta name="keywords" content="Java"><meta name="author" content="Ryan Miao"><meta name="copyright" content="Ryan Miao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言语言都是相通的，只要搞清楚概念后就可以编写代码了。而概念是需要学习成本的。"><meta property="og:type" content="article"><meta property="og:title" content="Java Web基础入门"><meta property="og:url" content="http://blog.rmiao.top/2017/11/12/Hello-Java-Web/index.html"><meta property="og:site_name" content="Ryan Miao的博客"><meta property="og:description" content="前言语言都是相通的，只要搞清楚概念后就可以编写代码了。而概念是需要学习成本的。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg"><meta property="article:published_time" content="2017-11-12T09:35:03.000Z"><meta property="article:modified_time" content="2020-11-10T13:25:51.132Z"><meta property="article:author" content="Ryan Miao"><meta property="article:tag" content="Java"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://blog.rmiao.top/2017/11/12/Hello-Java-Web/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="google-site-verification" content="maTgu7CiAQC-q4KDPYtjkPcCNliwRuCX8IuThKKIZzo"><meta name="baidu-site-verification" content="code-HNJaUItPgZ"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-9728761484167276",enable_page_level_ads:"true"})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?caff024b07e794f2b6ef044008b2acd3";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!0,isToc:!0,postUpdate:"2020-11-10 21:25:51"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="//at.alicdn.com/t/font_2204177_honuy9aiklh.css"><meta name="generator" content="Hexo 5.2.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/avatar.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">95</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">44</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ryan Miao的博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i> <span>Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java Web基础入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2017-11-12T09:35:03.000Z" title="发表于 2017-11-12 17:35:03">2017-11-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-11-10T13:25:51.132Z" title="更新于 2020-11-10 21:25:51">2020-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="Java Web基础入门"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1510489587800&di=367ad9e5c4515afa93b501d8db399296&imgtype=0&src=http%3A%2F%2Fa2.att.hudong.com%2F43%2F87%2F20300543669437145007874802107.jpg" alt="i18n" style="width:400px"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>语言都是相通的，只要搞清楚概念后就可以编写代码了。而概念是需要学习成本的。</p><a id="more"></a><h1 id="Java基础"><a href="#Java基础" class="headerlink" title="Java基础"></a>Java基础</h1><p>不用看《编程思想》,基础语法看 <a target="_blank" rel="noopener" href="http://www.runoob.com/java/java-basic-syntax.html">http://www.runoob.com/java/java-basic-syntax.html</a> 就可以了，入门后想干啥干啥，如果感兴趣，如果有时间。</p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><p>这里讲的web是指提供API(Application Programming Interface)的能力。那么什么是API?</p><p>API是指server端和client端进行资源交互的通道。Client可以通过API来获取和修改server端的资源(Resource). 实际上，API差不多就是URL的代称，现阶段，推荐采用RESTfull API.</p><h2 id="RESTfull-API"><a href="#RESTfull-API" class="headerlink" title="RESTfull API"></a>RESTfull API</h2><p>API表现方式就是URL(Uniform Resoure Locator)。RESTfull API是一个概念，规定了应该以什么样的结构去构建API，即应该如何拼接URL。先来看看URL是什么样子的。</p><p><img src="https://raw.githubusercontent.com/Ryan-Miao/MyDraw/master/API/url.png"></p><p><strong>资源（Resources）</strong><br>path中的<code>groups</code>和<code>users</code>都是资源的名称，通过参数来确定资源的位置。</p><p><strong>行为/操作(Method)</strong><br>我们通过约定的<code>Http Method</code>来表示对Resource的操作。</p><p>常用的HTTP动词有下面五个（括号里是对应的SQL命令）。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET（SELECT）：从服务器取出资源（一项或多项）。</span><br><span class="line">POST（CREATE）：在服务器新建一个资源。</span><br><span class="line">PUT（UPDATE）：在服务器更新资源（客户端提供改变后的完整资源）。</span><br><span class="line">PATCH（UPDATE）：在服务器更新资源（客户端提供改变的属性）。</span><br><span class="line">DELETE（DELETE）：从服务器删除资源。</span><br></pre></td></tr></table></figure><p>还有两个不常用的HTTP动词。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HEAD：获取资源的元数据。</span><br><span class="line">OPTIONS：获取信息，关于资源的哪些属性是客户端可以改变的。</span><br></pre></td></tr></table></figure><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;zoos：列出所有动物园</span><br><span class="line">POST &#x2F;zoos：新建一个动物园</span><br><span class="line">GET &#x2F;zoos&#x2F;ID：获取某个指定动物园的信息</span><br><span class="line">PUT &#x2F;zoos&#x2F;ID：更新某个指定动物园的信息（提供该动物园的全部信息）</span><br><span class="line">PATCH &#x2F;zoos&#x2F;ID：更新某个指定动物园的信息（提供该动物园的部分信息）</span><br><span class="line">DELETE &#x2F;zoos&#x2F;ID：删除某个动物园</span><br><span class="line">GET &#x2F;zoos&#x2F;ID&#x2F;animals：列出某个指定动物园的所有动物</span><br><span class="line">DELETE &#x2F;zoos&#x2F;ID&#x2F;animals&#x2F;ID：删除某个指定动物园的指定动物</span><br></pre></td></tr></table></figure><p>当path的组成仍旧无法准确定位资源的时候，可以通过queryParam来进一步缩小范围。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?limit&#x3D;10：指定返回记录的数量</span><br><span class="line">?offset&#x3D;10：指定返回记录的开始位置。</span><br><span class="line">?page&#x3D;2&amp;per_page&#x3D;100：指定第几页，以及每页的记录数。</span><br><span class="line">?sortby&#x3D;name&amp;order&#x3D;asc：指定返回结果按照哪个属性排序，以及排序顺序。</span><br><span class="line">?animal_type_id&#x3D;1：指定筛选条件</span><br></pre></td></tr></table></figure><p>更多关于构建RESTfull API的信息，参阅<a target="_blank" rel="noopener" href="https://codeplanet.io/principles-good-restful-api-design/">https://codeplanet.io/principles-good-restful-api-design/</a></p><h2 id="ContentType"><a href="#ContentType" class="headerlink" title="ContentType"></a>ContentType</h2><p>现在的接口都是基于JSON传输的，什么是JSON(JavaScript Object Notation)?</p><p>一个基于JSON的API的response应该包含以下header</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type:application&#x2F;json; charset&#x3D;utf-8</span><br></pre></td></tr></table></figure><h2 id="NodeJS-Web"><a href="#NodeJS-Web" class="headerlink" title="NodeJS Web"></a>NodeJS Web</h2><p>安装<a target="_blank" rel="noopener" href="http://www.cnblogs.com/woshimrf/p/nodejs-enrionment-install.html">NodeJS</a></p><p>然后，创建app.js, <code>npm install express --save</code>, <code>node app.js</code>， 访问<code>localhost:3000/</code>，<code>localhost:3000/json</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这句的意思就是引入 `express` 模块，并将它赋予 `express` 这个变量等待使用。</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">// 调用 express 实例，它是一个函数，不带参数调用时，会返回一个 express 实例，将这个变量赋予 app 变量。</span></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// app 本身有很多方法，其中包括最常用的 get、post、put/patch、delete，在这里我们调用其中的 get 方法，为我们的 `/` 路径指定一个 handler 函数。</span></span><br><span class="line"><span class="comment">// 这个 handler 函数会接收 req 和 res 两个对象，他们分别是请求的 request 和 response。</span></span><br><span class="line"><span class="comment">// request 中包含了浏览器传来的各种信息，比如 query 啊，body 啊，headers 啊之类的，都可以通过 req 对象访问到。</span></span><br><span class="line"><span class="comment">// res 对象，我们一般不从里面取信息，而是通过它来定制我们向浏览器输出的信息，比如 header 信息，比如想要向浏览器输出的内容。这里我们调用了它的 #send 方法，向浏览器输出一个字符串。</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.send(<span class="string">&#x27;Hello World&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/json&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> rs = &#123;&#125;;</span><br><span class="line">  rs.id=<span class="number">1</span>;</span><br><span class="line">  rs.name = <span class="string">&quot;Ryan&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  res.send(rs);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义好我们 app 的行为之后，让它监听本地的 3000 端口。这里的第二个函数是个回调函数，会在 listen 动作成功后执行，我们这里执行了一个命令行输出操作，告诉我们监听动作已完成。</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;app is listening at port 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="Java-Web"><a href="#Java-Web" class="headerlink" title="Java Web"></a>Java Web</h2><p>Java Web的开源框架中，目前最常用的是SpringBoot. SpringBoot可以提供API，可以渲染页面，是作为API Server的最佳选择。</p><p>写了无数遍hello world, 这次还是要从hello world开始。</p><h2 id="demo-source"><a href="#demo-source" class="headerlink" title="demo source"></a>demo source</h2><p><a target="_blank" rel="noopener" href="https://github.com/Ryan-Miao/springboot-demo-gradle">https://github.com/Ryan-Miao/springboot-demo-gradle</a></p><p>Java Web的包管理工具有maven，gradle。这里将使用gradle作为依赖管理工具。</p><h2 id="Gradle是什么"><a href="#Gradle是什么" class="headerlink" title="Gradle是什么"></a>Gradle是什么</h2><p><a target="_blank" rel="noopener" href="https://gradle.org/">gradle</a>是继maven之后，Java项目构建工具的集大成者。它管理依赖，为什么要管理依赖？我们的项目中将会使用很多其他的lib，这些lib有我们自己的，也有开源的，甚至大部分都是开源的。当引入这些lib的时候，引入哪个版本？去哪里下载？多个版本产生了冲突怎么办？以及最后我们项目开发完成后，怎么打包？甚至，想使用CI/CD自动化构建工具，如何集成？这就是gradle可以做的事情。</p><p>gradle要怎么学？</p><p>一般来说不用学，不用理会内置的逻辑，只需要用就好。就好比IDE，你不会深究IDE是c编写的还是Java编写的，但会使用IDE来编写代码。同样，gradle的用法很简单，可以满足我们开发中觉得部分需求。当然，当需要自定义功能的时候，可以使用<code>groovy</code>来编写gradle脚本。</p><h2 id="IntelIj-IDEA"><a href="#IntelIj-IDEA" class="headerlink" title="IntelIj IDEA"></a>IntelIj IDEA</h2><p>IDEA是目前构建Java Web项目最火IDE。用法和Eclipse还是有不少的区别，刚转过来的时候可能有点不习惯。但根据2-8原则，我们只需要掌握其中一部分用法就可以开发了，剩下的高级用法可以在开发中慢慢摸索。即，其实用法也很简单。</p><h2 id="新建一个gradle项目"><a href="#新建一个gradle项目" class="headerlink" title="新建一个gradle项目"></a>新建一个gradle项目</h2><p>点击<code>File</code>-&gt;<code>New</code>-&gt;<code>project</code>-&gt;<code>gradle</code>-&gt;勾选<code>Java</code><br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/new.png?raw=true"></p><p>如果发现没有JDK，那么new一个就好。</p><p>下一步，设置项目标签，group通常是公司名称倒写，比如<code>com.google</code>，<code>com.alibaba</code>等. ArtifactId就是我们的项目名称，比如这次demo为<code>springboot-demo</code><br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/group.png?raw=true"></p><p>然后一路next，完成后确定。IDEA会下载gradle，下载简单的依赖，完毕后，项目根目录下多出几个文件，目前不用care。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── build.gradle</span><br><span class="line">├── gradle</span><br><span class="line">│   └── wrapper</span><br><span class="line">│       ├── gradle-wrapper.jar</span><br><span class="line">│       └── gradle-wrapper.properties</span><br><span class="line">├── gradlew</span><br><span class="line">├── gradlew.bat</span><br><span class="line">├── settings.gradle</span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── java</span><br><span class="line">    │   └── resources</span><br><span class="line">    └── test</span><br><span class="line">        ├── java</span><br><span class="line">        └── resources</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来修改<code>build.gradle</code>，这个文件是依赖管理的核心文件</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">&quot;http://maven.aliyun.com/nexus/content/groups/public/&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath(<span class="string">&quot;org.springframework.boot:spring-boot-gradle-plugin:1.5.8.RELEASE&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;java&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;eclipse&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;idea&#x27;</span></span><br><span class="line">apply <span class="attr">plugin:</span> <span class="string">&#x27;org.springframework.boot&#x27;</span></span><br><span class="line"></span><br><span class="line">jar &#123;</span><br><span class="line">    baseName = <span class="string">&#x27;springboot-demo&#x27;</span></span><br><span class="line">    version =  <span class="string">&#x27;0.1.0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    maven &#123;</span><br><span class="line">        url <span class="string">&quot;http://maven.aliyun.com/nexus/content/groups/public/&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sourceCompatibility = <span class="number">1.8</span></span><br><span class="line">targetCompatibility = <span class="number">1.8</span></span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile(<span class="string">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span>)</span><br><span class="line">    testCompile(<span class="string">&#x27;org.springframework.boot:spring-boot-starter-test&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>maven是一个仓库，一些开源的第三方库lib都从这里下载，这里引用了aliyun镜像，因为maven在国内访问比较慢，如果在国外可以移除这个节点</li><li><code>buildscript</code>里就这么写，不用关心为什么，只需要知道这里这样写就可以引入springboot的版本</li><li><code>dependencies</code>是唯一会改变和增加内容的地方，当需要第三方库的时候添加，添加规则就是<code>groupId:artifactId:version</code>, 正好和我们创建项目的时候声明的标签一样</li></ul><p>修改<code>build.gradle</code>之后就要重新build，在IDEA中，点击右侧的工具栏，gradle，点击刷新按钮。就会自动下依赖，如果没有下载，点击gradle下Task里的<code>build</code>按钮。</p><p>另一个方式就是命令行：</p><p>细心可以发现项目根目录下有<code>gradlew</code>和<code>gradlew.bat</code>这个文件，这是分别为linux和windows准备的启动工具，在Linux系统中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;gradlew build</span><br><span class="line">or</span><br><span class="line">sh gradlew build</span><br></pre></td></tr></table></figure><p>在windows中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradlew build</span><br></pre></td></tr></table></figure><p>编译完成后，在左侧的项目目录下的<code>External Libraties</code>下可以看到我们引入的第三方库。为什么这么多？因为依赖是树状的，或者说网状的。lib也有他自己的依赖，gradle会负责把我们引入的lib的依赖也给下载下来。在没有maven和gradle这种构建工具之前，项目开发都是自己下载jar，自己丢进去classpath里，很容遗漏，也很容易造成冲突。gralde会负责下载依赖，还会解决冲突，比如不同版本等问题。</p><h2 id="开始编写服务端配置"><a href="#开始编写服务端配置" class="headerlink" title="开始编写服务端配置"></a>开始编写服务端配置</h2><p>Springboot的一个优点是约定大于配置，意思是我们都约定好怎么配置，我帮你配置好了，你直接用就好。因此，springmvc时代的大部分配置都可以自动化完成。我们的启动类也只有一行.</p><p>可以看到，<code>src/main/java</code>这个目录变成蓝色，在IDEA里是指sourceSet，也就是源文件，我们的Java代码就是放在这文件下的，这也是约定好的。</p><p>在该目录下新建<code>com.test.demo.Application.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan on 2017/11/13/0013.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>到这里，我们的服务端就配置完毕了。运行main方法即可启动。</p><h2 id="编写第一个API"><a href="#编写第一个API" class="headerlink" title="编写第一个API"></a>编写第一个API</h2><p>虽然服务端配置好了，但并没有API. 新建<code>com.test.demo.controller.HelloController.java</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan on 2017/11/14/0014.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;hello\&quot;:\&quot;world\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后，再次运行main方法，启动完毕后，访问 <a target="_blank" rel="noopener" href="http://localhost:8080/hello">http://localhost:8080/hello</a>, 第一个API开发完毕。</p><ul><li><code>@Controller</code>这个注解标注这个类是一个controller，用来接收请求和响应response</li><li><code>@GetMapping(&quot;/hello&quot;)</code>标注这个方法是一个路由请求实现，括号里就是我们的路由</li><li><code>@ResponseBody</code>这个注解标注这个API的返回值是json，其实就是再response的header里塞入了contentType, 当然，在这里还涉及到class转json的问题。那么，回到开始的问题，json是什么东西？</li></ul><p>JSON在Java里没有这个数据结构，其实就是一个String，遵从JSON规则的String，我们的方法在返回这段String的时候，加上header里的contentType，浏览器就会当做JSON读取。在Javascript去读Ajax的结果就变成了一个JSON对象了。其他的，比如Android，读取出来的还是一个字符串，需要手动反序列化成我们想要的类。</p><p>说到序列化，我们不可能每个返回结构都这样拼接字符串吧。所以，<code>ResponseBody</code>标注的请求还会使用一个jackson的适配器，这些都是springboot内置的。暂时也不需要研究实现原理。jackson是什么鬼？</p><p>jackson是Java中使用最广泛的一个json解析lib，他可以将一个Java 类转变成一个json字符串，也同样可以把一个json字符串反序列化成一个java对象。Springboot是如何做到的？这就需要去研究源码了。</p><h2 id="启动和调试"><a href="#启动和调试" class="headerlink" title="启动和调试"></a>启动和调试</h2><p>最简单的是启动就是运行main方法，还可以命令行启动</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradlew bootRun</span><br></pre></td></tr></table></figure><p>debug，最简单的就是以debug启动main方法。当然也可以远程。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradlew bootRun --debug-jvm</span><br></pre></td></tr></table></figure><p><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/commandline-debug.png?raw=true"></p><p>然后，在IDEA中，点击Edit configurations<br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/edit-configurations.png?raw=true"></p><p>选择remote<br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/remote.png?raw=true"><br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/debug.png?raw=true"></p><p>然后，点击debug<br><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/debug-start.png?raw=true"></p><p>如果想支持热加载，则需要添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-devtools&quot;)</span><br></pre></td></tr></table></figure><p>在IDEA里修改Java class后需要，重新build当前class才能生效。快捷键 <code>ctrl+shif+F9</code></p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>spring boot默认配置了很多东西，但有时候我们想要修改默认值，比如不想用8080作为端口，因为端口被占用了。</p><p>在<code>resources</code>下，新建<code>application.properties</code>, 然后在里面输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port&#x3D;8081</span><br></pre></td></tr></table></figure><p>然后，重启项目，发现端口已经生效。</p><p>再配置一些common的自定义，比如日志。项目肯定要记录日志的，<code>System.out.println</code>远远达不到日志的要求。springboot默认采用<code>Logback</code>作为日志处理工具。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.output.ansi.enabled&#x3D;ALWAYS</span><br><span class="line">logging.file&#x3D;logs&#x2F;demo.log</span><br><span class="line">logging.level.root&#x3D;INFO</span><br></pre></td></tr></table></figure><p>接着，开发和生产环境的配置必然不同的，比如数据库的地址不同，那么可以分配置文件来区分环境。</p><p>在resources下新建<code>application-dev.properties</code>, <code>application-prod.properties</code>. spring默认通过后缀不同来识别不同的环境，不加后缀的是base配置。那么如何生效呢？</p><p>只要在base的配置文件中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active&#x3D;dev</span><br></pre></td></tr></table></figure><p>比如，我们在dev环境中设置loglevel为debug</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root&#x3D;debug</span><br></pre></td></tr></table></figure><p>这样，springboot会优先读取base文件，然后读取dev，当dev有相同的配置项时，dev会覆盖base。</p><p>这样，本地开发和生产环境隔离，部署也方便。事实上，springboot接收参数的优先级为<code>resources下的配置文件</code>&lt;<code>命令行参数</code>. 通常，我们部署项目的脚本会使用命令行参数来覆盖配置文件，这样就可以动态指定配置文件了。</p><h2 id="接收参数，响应JSON"><a href="#接收参数，响应JSON" class="headerlink" title="接收参数，响应JSON"></a>接收参数，响应JSON</h2><p>新建一个controller, com.test.demo.controller.ParamController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan on 2017/11/16/0016.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/param&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParamController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ParamController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hotels/&#123;htid&#125;/rooms&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Long&gt; <span class="title">getRooms</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@PathVariable</span> String htid,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam</span> String langId,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = &quot;limit&quot;, required = false, defaultValue = &quot;10&quot;)</span> <span class="keyword">int</span> limit,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestParam(value = &quot;offset&quot;, required = false, defaultValue = &quot;1&quot;)</span> <span class="keyword">int</span> offset</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;hotelId&quot;</span>, htid);</span><br><span class="line">        params.put(<span class="string">&quot;langId&quot;</span>, langId);</span><br><span class="line">        params.put(<span class="string">&quot;limit&quot;</span>, limit);</span><br><span class="line">        params.put(<span class="string">&quot;offset&quot;</span>, offset);</span><br><span class="line"></span><br><span class="line">        LOGGER.info(<span class="string">&quot;The params is &#123;&#125;&quot;</span>, params);</span><br><span class="line"></span><br><span class="line">        List&lt;Long&gt; roomIds = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        roomIds.add(<span class="number">1L</span>);</span><br><span class="line">        roomIds.add(<span class="number">2L</span>);</span><br><span class="line">        roomIds.add(<span class="number">3L</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> roomIds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>LOG: 采用Sl4J接口</li><li>参数： <code>@PathVariable</code> 可以接收url路径中的参数</li><li>参数： <code>@RequestParam</code> 可以接收<code>?</code>后的query参数</li><li>响应： <code>@RestController</code> == <code>@Controller+@ResponseBody</code>, 其实，<code>@ResponseBody</code>注解表明这个方法会返回json，会将Java类转换成JSON字符串，默认转换器为Jackason</li></ol><h3 id="参数为JSON"><a href="#参数为JSON" class="headerlink" title="参数为JSON"></a>参数为JSON</h3><p>新建class com.test.demo.entity.Room</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class Room &#123;</span><br><span class="line">    private Integer roomId;</span><br><span class="line">    private String roomName;</span><br><span class="line">    private String comment;</span><br><span class="line"></span><br><span class="line">    public Integer getRoomId() &#123;</span><br><span class="line">        return roomId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRoomId(Integer roomId) &#123;</span><br><span class="line">        this.roomId &#x3D; roomId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getRoomName() &#123;</span><br><span class="line">        return roomName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setRoomName(String roomName) &#123;</span><br><span class="line">        this.roomName &#x3D; roomName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getComment() &#123;</span><br><span class="line">        return comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setComment(String comment) &#123;</span><br><span class="line">        this.comment &#x3D; comment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>假设，我们需要保存一个Room信息，先来get一个</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hotels/&#123;htid&#125;/rooms/&#123;roomId&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Room <span class="title">getRoomById</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@PathVariable</span> String htid,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@PathVariable</span> Integer roomId</span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (htid.equals(<span class="string">&quot;6606&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">final</span> Room room = <span class="keyword">new</span> Room();</span><br><span class="line">        room.setComment(<span class="string">&quot;None&quot;</span>);</span><br><span class="line">        room.setRoomId(roomId);</span><br><span class="line">        room.setRoomName(<span class="string">&quot;豪华双人间&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> room;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后保存一个</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/hotels/&#123;htid&#125;/rooms&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">addRoom</span><span class="params">(<span class="meta">@RequestBody</span> Room room)</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> id = random.nextInt(<span class="number">10</span>);</span><br><span class="line">    room.setRoomId(id);</span><br><span class="line"></span><br><span class="line">    LOGGER.info(<span class="string">&quot;Add a room: &#123;&#125;&quot;</span>, room);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/save-room.png?raw=true"></p><h3 id="接收数组参数"><a href="#接收数组参数" class="headerlink" title="接收数组参数"></a>接收数组参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hotels/&#123;htid&#125;/rooms/ids&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getRoomsWithIds</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Integer&gt; ids)</span></span>&#123;</span><br><span class="line">    String s = ids.toString();</span><br><span class="line">    LOGGER.info(s);</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:8081/param//hotels/6606/rooms/ids?ids=1,2,3">http://localhost:8081/param//hotels/6606/rooms/ids?ids=1,2,3</a></p><h2 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a>参数校验</h2><p>我们除了一个个的if去判断参数，还可以使用注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Room</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer roomId;</span><br><span class="line">    <span class="meta">@NotEmpty</span></span><br><span class="line">    <span class="meta">@Size(min = 3, max = 20, message = &quot;The size of room name should between 3 and 20&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String roomName;</span><br></pre></td></tr></table></figure><p>只要在参数前添加<code>javax.validation.Valid</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/hotels/&#123;htid&#125;/rooms&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addRoom</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> Room room,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="meta">@RequestHeader(name = &quot;transactionId&quot;)</span> String transactionId</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>&#123;</span><br></pre></td></tr></table></figure><p><img src="https://github.com/Ryan-Miao/springboot-demo-gradle/blob/master/doc/valid.png?raw=true"></p><h2 id="静态文件"><a href="#静态文件" class="headerlink" title="静态文件"></a>静态文件</h2><p>在springboot中，static content默认寻找规则是</p><blockquote><p>By default Spring Boot will serve static content from a directory called <code>/static</code> (or <code>/public</code> or <code>/resources</code> or <code>/META-INF/resources</code>) in the classpath or from the root of the ServletContext.</p></blockquote><p>在<code>resources</code>下新建文件夹 <code>static</code>,<br>src\main\resources\static\content.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Hello static content<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/test.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Static Content<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Static content is the files that render directly, the file is the whole content. The different between template is that</span><br><span class="line">the template page will be resolved by server and then render out.</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器访问： <a target="_blank" rel="noopener" href="http://localhost:8081/content.html">http://localhost:8081/content.html</a></p><p>同理，放在static下的文件都可以通过如此映射访问。</p><h2 id="模板文件"><a href="#模板文件" class="headerlink" title="模板文件"></a>模板文件</h2><p>模板文件是指通过服务端生成的文件。比如Jsp，会经过servlet编译后，最终生成一个html页面。Springboot默认支持以下几种模板：</p><blockquote><p>FreeMarker<br>Groovy<br>Thymeleaf<br>Mustache</p></blockquote><p>JSP在jar文件中的表现有问题，除非部署为war。</p><p>官方推荐的模板为<code>Thymeleaf</code>， 在depenency中添加依赖：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter-thymeleaf&quot;)</span><br></pre></td></tr></table></figure><p>rebuild.</p><p>SpringBoot默认模板文件读取位置为：<code>src\main\resources\templates</code>. 新建 <code>src\main\resources\templates\home.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Template content<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125; + &#x27; The current user is:&#x27; + $&#123;user.name&#125;&quot;</span>&gt;</span>Welcome!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>模板文件只能通过服务端路由渲染，也就是说不能像刚开始静态文件那样直接路由过去。</p><p>创建一个controller， <code>com.test.demo.controller.HomeController</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan on 2017/11/18/0018.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/home&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(Model model, String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Map&lt;String, Object&gt; user = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        user.put(<span class="string">&quot;name&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;user&quot;</span>, user);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Hello World!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个和之前的API的接口有一点不同，首先是没有<code>@ResponseBody</code>注解，然后是方法的返回值是一个String，这个String不是value，而是指模板文件的位置，相对于<code>templates</code>的位置。</p><p>浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:8081/home?name=Ryan123">http://localhost:8081/home?name=Ryan123</a></p><p>方法参数的<code>Model</code>是模板文件的变量来源，模板文件从这个对象里读取变量，将这个类放到参数里，Spring会自动注入这个类，绑定到模板文件。这里，放入两个变量。</p><p>在模板端，就可以读取这个变量了。</p><p>为什么要这么做？既然有了静态文件，为什么还要模板文件？</p><p>首先，这是早期web开发的做法，之前是没有web 前端这个兵种的，页面从静态页面变成动态页面，代表就是jsp，php等。模板文件的有个好处是，服务端可以控制页面，比如从session中拿到用户信息，放入页面。这个在静态页面是做不到的。</p><p>然而，现在前后端的分离实践，使得模板文件的作用越来越小。目前主要用于基础数据传递，其他数据则通过客户端的异步请求获得。</p><p>当然，随着页面构建复杂，异步请求太多，首屏渲染时间越来越长，严重影响了用户体验，比如淘宝双11的宣传页。这时候，服务端渲染的优势又体现出来了，静态页面直接出数据，不需要多次的ajax请求。</p><h2 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h2><blockquote><p>Cross-origin resource sharing (CORS) is a W3C specification implemented by most browsers that allows you to specify in a flexible way what kind of cross domain requests are authorized, instead of using some less secure and less powerful approaches like IFRAME or JSONP.</p></blockquote><p>CORS是浏览器的一种安全保护，隔离不同域名之间的可见度。比如，不允许把本域名下cookie发送给另一个域名，否则cookie被钓鱼后，黑客就可以模拟本人登陆了。更多细节参考<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">MDN</a></p><p>为什么浏览器要拒绝cors?<br>摘自<a href="">博客园</a></p><p><img src="http://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg"></p><p>cors执行过程摘自<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">自由的维基百科</a><br><img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/Flowchart_showing_Simple_and_Preflight_XHR.svg"></p><p>首先，本地模拟跨域请求。</p><p>我们当前demo的域名为<code>localhost:8081</code>，现在新增一个本地域名, 在HOSTS文件中新增：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   corshost</span><br></pre></td></tr></table></figure><p>然后，访问<a href="http://corshost:8081，即本demo。">http://corshost:8081，即本demo。</a></p><p>新增src\main\resources\static\cors.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Test Cors<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/3.2.1/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $.ajax(&#123; <span class="attr">url</span>: <span class="string">&quot;http://localhost:8081/hello&quot;</span>, <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(data);</span></span><br><span class="line">    &#125;&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>访问之前创建的hello接口，可以看到访问失败，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Failed to load http:&#x2F;&#x2F;localhost:8081&#x2F;hello: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. Origin &#39;http:&#x2F;&#x2F;corshost:8081&#39; is therefore not allowed access.</span><br></pre></td></tr></table></figure><p>这是浏览器正常的行为。</p><p>但，由于前后端分离，甚至分开部署，域名肯定不会是同一个了，那么就需要支持跨域。Springboot支持跨域，解决方案如下：</p><p>在需要跨域的method上，添加一个<code>@CrossOrigin</code>注解即可。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@CrossOrigin(origins &#x3D; &#123;&quot;http:&#x2F;&#x2F;corshost:8081&quot;&#125;)</span><br><span class="line">@ResponseBody</span><br><span class="line">@GetMapping(&quot;&#x2F;hello&quot;)</span><br><span class="line">public String hello()&#123;</span><br><span class="line">    return &quot;&#123;\&quot;hello\&quot;:\&quot;world\&quot;&#125;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果是全局配置允许跨域，新建<code>com.test.demo.config.CorsConfiguration</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">package com.test.demo.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.CorsRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurerAdapter;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by Ryan on 2017&#x2F;11&#x2F;18&#x2F;0018.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class CorsConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public WebMvcConfigurer corsConfigurer() &#123;</span><br><span class="line">        return new WebMvcConfigurerAdapter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">                registry.addMapping(&quot;&#x2F;api&#x2F;**&quot;)</span><br><span class="line">                        .allowedOrigins(&quot;http:&#x2F;&#x2F;domain2.com&quot;)</span><br><span class="line">                        .allowedMethods(&quot;PUT&quot;, &quot;DELETE&quot;)</span><br><span class="line">                        .allowedHeaders(&quot;header1&quot;, &quot;header2&quot;, &quot;header3&quot;)</span><br><span class="line">                        .exposedHeaders(&quot;header1&quot;, &quot;header2&quot;)</span><br><span class="line">                        .allowCredentials(false).maxAge(3600);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>刚开始看Springboot的时候看到推荐使用<code>fat jar</code>部署，于是<a target="_blank" rel="noopener" href="http://www.cnblogs.com/woshimrf/p/springboot-jar.html">记录</a>下来。后面看到公司的生产环境中既有使用war也有使用jar的，为了方便，非不得已，还是使用jar来部署。</p><p>首先，打包：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradlew clean build</span><br></pre></td></tr></table></figure><p>然后，可以看到，在build/libs下有两个jar，<code>springboot-demo-0.1.0.jar.original</code>和<code>springboot-demo-0.1.0.jar</code>。后面这个就是springboot插件打包好的<code>fat jar</code>，前一个是gradle打包的源jar。接着就可以直接运行这个jar，prod也是如此。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar build&#x2F;libs&#x2F;springboot-demo-0.1.0.jar --spring.profiles.active&#x3D;prod</span><br></pre></td></tr></table></figure><p>后面通过参数来指定配置文件的环境，这种命令行参数的优先级要高于配置在base里的，所以会覆盖变量，因此，最终采用的就是prod这个环境配置。</p><h2 id="引入MySQL-MariaDB"><a href="#引入MySQL-MariaDB" class="headerlink" title="引入MySQL/MariaDB"></a>引入MySQL/MariaDB</h2><p>MySQL被Oracle收走之后，他的father另外创建了新的社区分支<a target="_blank" rel="noopener" href="https://downloads.mariadb.org/mariadb/10.2.10/">MariaDB</a>, 据说用法和MySQL一致。然后，各大Linux开源系统都预置了MariaDB。 当然，由于新出没多久，市场还不够开阔。根据[DB-Engines Ranking]发布的<a target="_blank" rel="noopener" href="https://db-engines.com/en/ranking">2017年11月份排行</a>， MySQL几乎完全接近Oracle，排名第二。而MariaDB的上升之路还比较遥远。So，还是入手MySQL靠谱。因为开源技术的掌握能力和跳槽能力成正相关。</p><h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><p>MAC安装参考<a target="_blank" rel="noopener" href="http://ryan-miao.github.io/2017/06/28/mac-install-mysql/">Mac install MySQL</a>。</p><p>Windows安装</p><p>去<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">官网</a>下载安装包(mysql-5.7.20-winx64.zip). 当然，需要先注册oracle账号。</p><p>解压当目录，然后将bin目录加入环境变量，同Java设置环境变量。这里再次演示下。复制bin目录地址，我的为<code>D:\data\mysql\mysql-5.7.20-winx64\bin</code>, 在<code>此电脑</code>右键，–&gt; 属性 –&gt; 高级系统设置 –&gt; 高级 –&gt; 环境变量 –&gt; 在系统环境变量中找到path –&gt; 新建 –&gt; 填入 –&gt; 确认。</p><p>然后，重新打开cmd。输入<code>mysqld --initialize --console</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Ryan</span><br><span class="line">λ mysqld --initialize --console</span><br><span class="line">mysqld: Could not create or access the registry key needed for the MySQL application</span><br><span class="line">to log to the Windows EventLog. Run the application with sufficient</span><br><span class="line">privileges once to create the key, add the key manually, or turn off</span><br><span class="line">logging for that application.</span><br><span class="line">2017-11-26T05:22:48.434089Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please use --explicit_defaults_for_timestamp server option (see documentation for more details).</span><br><span class="line">2017-11-26T05:22:48.437096Z 0 [ERROR] Cannot open Windows EventLog; check privileges, or start server with --log_syslog&#x3D;0</span><br><span class="line">2017-11-26T05:22:49.148986Z 0 [Warning] InnoDB: New log files created, LSN&#x3D;45790</span><br><span class="line">2017-11-26T05:22:49.276866Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2017-11-26T05:22:49.370828Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: d7e6ac05-d269-11e7-a91e-9883891ed8e3.</span><br><span class="line">2017-11-26T05:22:49.383970Z 0 [Warning] Gtid table is not ready to be used. Table &#39;mysql.gtid_executed&#39; cannot be opened.</span><br><span class="line">2017-11-26T05:22:49.398975Z 1 [Note] A temporary password is generated for root@localhost: &#x2F;r.Vtktfl9FN</span><br></pre></td></tr></table></figure><p>复制我们的临时密码<code>/r.Vtktfl9FN</code>.</p><p>命令行启动MySQL：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --console</span><br></pre></td></tr></table></figure><p>新开一个cmd，命令行输入账号密码<code>mysql -u root -p</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Ryan</span><br><span class="line">λ mysql -u root -p</span><br><span class="line">Enter password: ************</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.7.20</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2017, Oracle and&#x2F;or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and&#x2F;or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure><p>然后就连接到MySQL了。第一个命令行就是启动mysql，第二个命令行就是client，连接MySQL。现在修改我们的<code>root</code>密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set password&#x3D;password(&#39;123456&#39;);</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure><p>然后，关闭client，输入<code>exit</code>退出。 重新以新密码123456登陆(不要自己难为自己，设置密码为123456是最佳选择).</p><p>确认成功就安装完毕。账号为<code>root</code>, 密码为<code>123456</code>。</p><h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>关于MySQL的基本语法，学习<a target="_blank" rel="noopener" href="http://www.runoob.com/mysql/mysql-tutorial.html">http://www.runoob.com/mysql/mysql-tutorial.html</a> 即可。</p><p>这里简单记录几个简单的概念。</p><h3 id="database"><a href="#database" class="headerlink" title="database"></a>database</h3><p>MySQL以不同的database为单位存储数据。所以，开发数据库的时候，先要创建一个database。</p><p>查看已有的database</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>创建我们的database</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database if not exists springboot_demo charset utf8 collate utf8_general_ci;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure><p>进入database：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use springboot_demo</span><br><span class="line">Database changed</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>查看当前database的所有表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; use springboot_demo</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure><p>创建一个表<code>room</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table if not exists room (</span><br><span class="line">    -&gt;   id INT(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">    -&gt;   &#96;name&#96; VARCHAR(80) NOT NULL,</span><br><span class="line">    -&gt;   &#96;comment&#96; VARCHAR(200),</span><br><span class="line">    -&gt;   create_date DATETIME,</span><br><span class="line">    -&gt;   update_date DATETIME,</span><br><span class="line">    -&gt;   PRIMARY KEY(id)</span><br><span class="line">    -&gt; )ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</span><br><span class="line">Query OK, 0 rows affected (0.08 sec)</span><br></pre></td></tr></table></figure><ol><li><code>create table</code> 创建表</li><li><code>if not exists</code> 如果不存在则创建</li><li><code>room</code> 表名</li><li><code>id</code> 表字段，字段名为<code>id</code>, <code>NOT NULL</code>表示会给这个字段建立非空索引，当存入空时会报错。如果不写明<code>NOT NULL</code>，则默认该字段可以为空。</li><li><code>AUTO_INCREMENT</code>表示这个字段会自动增加，即当保存一条记录的时候，如果不传入<code>id</code>这个字段，则该字段会从系统序列中取出一个。该序列是一个递增序列。即实现了每次id都增加1</li><li><code>反引号</code>包裹字段名是为了防止与关键字冲突</li><li><code>INT</code> 是指数字类型，括号里的<code>11</code>是指MySQL里的显示宽度，和最大值取值范围无关，是指需要多少位来表示这个数字，不够长度的补齐。int最大值为<code>2147483647</code></li><li><code>VARCHAR</code>是变长字符串，即当存储1个字符，则占用空间就是1个字节，当存储2个字符，则占用空间为2个字符。与之对应的是<code>char</code>定长。括号里的是指字符的个数，即最大允许200个字符。</li><li><code>DATA</code>是日期类型，通常每条记录都需要记录创建时间和更新时间</li><li><code>PRIMARY KEY</code>表示这个字段是<code>主键</code>，即该记录的唯一标识符。</li></ol><h3 id="插入一条记录"><a href="#插入一条记录" class="headerlink" title="插入一条记录"></a>插入一条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into room(&#96;name&#96;, &#96;comment&#96;, &#96;create_date&#96;, &#96;update_date&#96;) values (&quot;大床房&quot;, &quot;&quot;, &quot;2017-11-26&quot;,&quot;2017-11-26</span><br><span class="line">11:00:00&quot;);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br><span class="line"> </span><br><span class="line">mysql&gt;insert into room(&#96;name&#96;, &#96;comment&#96;, &#96;create_date&#96;, &#96;update_date&#96;) values (&quot;双人床房&quot;, &quot;有窗户&quot;, &quot;2017-11-26&quot;,&quot;201</span><br><span class="line">7-11-26 11:00:00&quot;);</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure><h3 id="查看所有记录"><a href="#查看所有记录" class="headerlink" title="查看所有记录"></a>查看所有记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from room;</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">| id | name     | comment | create_date | update_date |</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">|  1 | 大床房   |         | 2017-11-26  | 2017-11-26  |</span><br><span class="line">|  2 | 双人床房 | 有窗户  | 2017-11-26  | 2017-11-26  |</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="更新一条记录"><a href="#更新一条记录" class="headerlink" title="更新一条记录"></a>更新一条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; update room set comment&#x3D;&quot;无窗&quot; where id&#x3D;1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from room;</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">| id | name     | comment | create_date | update_date |</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">|  1 | 大床房   | 无窗    | 2017-11-26  | 2017-11-26  |</span><br><span class="line">|  2 | 双人床房 | 有窗户  | 2017-11-26  | 2017-11-26  |</span><br><span class="line">+----+----------+---------+-------------+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="删除一条记录"><a href="#删除一条记录" class="headerlink" title="删除一条记录"></a>删除一条记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from room where id &#x3D; 2;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from room;</span><br><span class="line">+----+--------+---------+-------------+-------------+</span><br><span class="line">| id | name   | comment | create_date | update_date |</span><br><span class="line">+----+--------+---------+-------------+-------------+</span><br><span class="line">|  1 | 大床房 | 无窗    | 2017-11-26  | 2017-11-26  |</span><br><span class="line">+----+--------+---------+-------------+-------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="什么是数据操纵语句"><a href="#什么是数据操纵语句" class="headerlink" title="什么是数据操纵语句"></a>什么是数据操纵语句</h3><p>以下来自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/study-s/p/5287529.html">博客园</a>。</p><p>SQL语言共分为四大类：数据查询语言DQL，数据操纵语言DML，数据定义语言DDL，数据控制语言DCL。</p><p><strong>1. 数据查询语言DQL</strong></p><p>数据查询语言DQL基本结构是由SELECT子句，FROM子句，WHERE<br>子句组成的查询块：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT &lt;字段名表&gt;</span><br><span class="line">FROM &lt;表或视图名&gt;</span><br><span class="line">WHERE &lt;查询条件&gt;</span><br></pre></td></tr></table></figure><p><strong>2 .数据操纵语言DML</strong></p><p>数据操纵语言DML主要有三种形式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) 插入：INSERT</span><br><span class="line">2) 更新：UPDATE</span><br><span class="line">3) 删除：DELETE</span><br></pre></td></tr></table></figure><p><strong>3. 数据定义语言DDL</strong></p><p>数据定义语言DDL用来创建数据库中的各种对象—–表、视图、<br>索引、同义词、聚簇等如：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE&#x2F;VIEW&#x2F;INDEX&#x2F;SYN&#x2F;CLUSTER</span><br><span class="line"></span><br><span class="line">        表 &#x2F;视图&#x2F; 索引&#x2F; 同义词&#x2F; 簇</span><br></pre></td></tr></table></figure><p>DDL操作是隐性提交的！不能rollback.</p><p><strong>4. 数据控制语言DCL</strong></p><p>数据控制语言DCL用来授予或回收访问数据库的某种特权，并控制<br>数据库操纵事务发生的时间及效果，对数据库实行监视等。如：</p><p><strong>1) GRANT</strong>：授权。</p><p>**2) ROLLBACK [WORK] TO [SAVEPOINT]**：回退到某一点。<br>回滚—ROLLBACK<br>回滚命令使数据库状态回到上次最后提交的状态。其格式为：<br>SQL&gt;ROLLBACK;</p><p>**3) COMMIT [WORK]**：提交。</p><p>在数据库的插入、删除和修改操作时，只有当事务在提交到数据<br>库时才算完成。在事务提交前，只有操作数据库的这个人才能有权看<br>到所做的事情，别人只有在最后提交完成后才可以看到。<br>提交数据有三种类型：显式提交、隐式提交及自动提交。下面分<br>别说明这三种类型。</p><p><strong>(1) 显式提交</strong><br>用COMMIT命令直接完成的提交为显式提交。其格式为：<br><code>SQL&gt;COMMIT</code>；</p><p><strong>(2) 隐式提交</strong><br>用SQL命令间接完成的提交为隐式提交。这些命令是：<br><code>ALTER</code>，<code>AUDIT</code>，<code>COMMENT</code>，<code>CONNECT</code>，<code>CREATE</code>，<code>DISCONNECT</code>，<code>DROP</code>，<br><code>EXIT</code>，<code>GRANT</code>，<code>NOAUDIT</code>，<code>QUIT</code>，<code>REVOKE</code>，<code>RENAME</code>。</p><p><strong>(3) 自动提交</strong><br>若把AUTOCOMMIT设置为ON，则在插入、修改、删除语句执行后，<br>系统将自动进行提交，这就是自动提交。其格式为：<br><code>SQL&gt;SET AUTOCOMMIT ON</code>；</p><p>到此，增删改查语句复习完毕。开始引入项目。</p><h2 id="项目连接MySQL"><a href="#项目连接MySQL" class="headerlink" title="项目连接MySQL"></a>项目连接MySQL</h2><p>保持MySQL打开状态。</p><p>引入mysql驱动和spring-jdbc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter-jdbc&quot;)</span><br><span class="line">compile group: &#39;mysql&#39;, name: &#39;mysql-connector-java&#39;, version: &#39;6.0.6&#39;</span><br></pre></td></tr></table></figure><p>修改配置文件，新增：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;springboot_demo?serverTimezone&#x3D;UTC&amp;characterEncoding&#x3D;utf-8</span><br><span class="line">spring.datasource.username&#x3D;root</span><br><span class="line">spring.datasource.password&#x3D;123456</span><br><span class="line">spring.datasource.driver-class-name&#x3D;com.mysql.jdbc.Driver</span><br></pre></td></tr></table></figure><p>新建com.test.demo.config.DBConfiguration</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConfiguration</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">(<span class="meta">@Qualifier(&quot;dataSource&quot;)</span> DataSource dataSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JdbcTemplate(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>@Configuration</code> 标注这个类是一个配置类，spring会自动扫描这个注解，将里面的配置运行。</li><li><code>@Bean</code> 标注声明一个Bean，由spring管理，在需要的地方注入。</li><li><code>@Qualifier(&quot;dataSource&quot;)</code> @Bean的参数列表中对象会从spring容器中查找bean，找到后注入参数。而<code>Qualifier</code>则声明要注入的bean的name或者id是什么，这在spring容器包含2个以上同类型的bean的时候有用。</li><li><code>DataSource</code> 这个对象是springboot自动创建的，通过扫描配置类里的配置，当检测到有配置datasource的时候会创建这个bean。于是，在这里就可以注入了，即我们配置的那几个属性。</li><li><code>JdbcTemplate</code> 一个封装了对DB操作的library, 通过它来对数据库操作。</li></ol><p>下面写一个测试来测试是否联通了。在src/test/java下，新建com.test.demo.config.DBConfigurationTest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.test.demo.Application;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Import(&#123;Application.class, DBConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBConfigurationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(<span class="string">&quot;select * from room&quot;</span>);</span><br><span class="line">        System.out.println(maps);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台打印出刚才的数据库中的数据：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;id&#x3D;1, name&#x3D;大床房, comment&#x3D;无窗, create_date&#x3D;2017-11-26, update_date&#x3D;2017-11-26&#125;]</span><br></pre></td></tr></table></figure><ol><li><code>@RunWith(SpringRunner.class)</code>运行spring容器的测试</li><li><code>@SpringBootTest</code> springboot测试</li><li><code>@Import(&#123;Application.class, DBConfiguration.class&#125;)</code> 导入我们需要的配置</li><li><code>@Autowired</code>自动注入属性，刚才在Configuration中声明了一个Bean，在这里通过这个注解获取那个bean</li><li><code>@Test</code> 这是一个JUnit测试</li></ol><h2 id="JDBCTemplate"><a href="#JDBCTemplate" class="headerlink" title="JDBCTemplate"></a>JDBCTemplate</h2><p><code>Spring-JDBC</code>提供了简化版的数据库连接操作。对于简单的连接数据库来说，spring-jdbc已经足够提供orm能力。当然，现在国内流行的orm还是Mybatis。不过，随着微服务拆分的盛行，jpa的优势更加明显。不管用什么框架，原理都是差不多的，就是封装复杂的映射逻辑，简化操作。</p><p><strong>什么是JDBC</strong>?<br>JDBC即Java DataBase Connectivity，Java数据库连接，JDK自带了JDBC。</p><p><strong>什么是Mybatis</strong>？<br>以下来自<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/MyBatis">百度百科</a></p><blockquote><p>MyBatis 是一款优秀的持久层框架，它支持定制化 SQL、存储过程以及高级映射。MyBatis 避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集。MyBatis 可以使用简单的 XML 或注解来配置和映射原生信息，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。</p></blockquote><p><strong>什么是JPA</strong>?<br>JPA是Java Persistence API的简称，中文名Java持久层API.</p><p><strong>什么是ORM</strong>?</p><blockquote><p>对象关系映射（英语：(Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换[1] 。从效果上说，它其实是创建了一个可在编程语言里使用的–“虚拟对象数据库”。</p></blockquote><blockquote><p>面向对象是从软件工程基本原则（如耦合、聚合、封装）的基础上发展起来的，而关系数据库则是从数学理论发展而来的，两套理论存在显著的区别。为了解决这个不匹配的现象，对象关系映射技术应运而生。</p></blockquote><blockquote><p>对象关系映射（Object-Relational Mapping）提供了概念性的、易于理解的模型化数据的方法。ORM方法论基于三个核心原则：</p><ol><li>简单：以最基本的形式建模数据。</li><li>传达性：数据库结构被任何人都能理解的语言文档化。</li><li>精确性：基于数据模型创建正确标准化的结构。<br>典型地，建模者通过收集来自那些熟悉应用程序但不熟练的数据建模者的人的信息开发信息模型。建模者必须能够用非技术企业专家可以理解的术语在概念层次上与数据结构进行通讯。建模者也必须能以简单的单元分析信息，对样本数据进行处理。ORM专门被设计为改进这种联系。<br>简单的说：ORM相当于中继数据, 即通过操作对象来完成sql语句，自动提供了对象和sql的映射。</li></ol></blockquote><p>为什么明明标题是JDBCTemplate, 却说了一堆别的？实际生产中，对关系型数据库的操作多是用Mybatis或Hibernate这样的ORM框架。而ORM框架的根源还是jdbc，因此，学习jdbc是学习其他ORM框架的第一步。</p><p>为什么不直接讲jdk自带的jdbc？当Java基础掌握好之后，jdbc也就是多一个library，学习jdbc也就是学习这个lib的用法而已。那么，既然有简化的spring-jdbc，自然可以先跳过原生。</p><p>下面开始简单使用spring-jdbc。</p><hr><h3 id="插入一条数据"><a href="#插入一条数据" class="headerlink" title="插入一条数据"></a>插入一条数据</h3><p>在上一步的新建的<code>com.test.demo.config.DBConfigurationTest</code>中继续开发。添加一个新的测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> RoomTable room = <span class="keyword">new</span> RoomTable(<span class="string">&quot;Doule Bed&quot;</span>, <span class="string">&quot;no&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;INSERT INTO room(`name`, `comment`, `create_date`, `update_date`) VALUES (?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> rs = jdbcTemplate.update(sql,</span><br><span class="line">            room.getName(), room.getComment(), room.getCreateDate(), room.getUpdateDate());</span><br><span class="line">    System.out.println(rs);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>@Transactional</code>是spring提供的事物注解，标注这个在测试类中的含义是：每次运行完该测试类后，回滚(rollback).</li><li><code>jdbcTemplate.update(sql, 参数)</code> 提供了占位符的数据操纵语句的执行。为什么要使用占位符(PreparedStatement)而不是直接拼接字符串？防止sql注入。</li><li><code>RoomTable</code>是一个新建Entity，关于什么是Entity后面分层架构中将讲到。</li><li><code>rs</code>是执行sql结束后，数据返回的一个数字，含义成功了多少行。</li></ol><p>新建com.test.demo.domain.entity.RoomTable</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan Miao on 12/2/17.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RoomTable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">    <span class="keyword">private</span> Date updateDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RoomTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RoomTable</span><span class="params">(String name, String comment, Date createDate, Date updateDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.comment = comment;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">        <span class="keyword">this</span>.updateDate = updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RoomTable</span><span class="params">(Integer id, String name, String comment, Date createDate, Date updateDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.comment = comment;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">        <span class="keyword">this</span>.updateDate = updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getComment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setComment</span><span class="params">(String comment)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.comment = comment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getUpdateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdateDate</span><span class="params">(Date updateDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.updateDate = updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;RoomTable&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, comment=&#x27;&quot;</span> + comment + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, createDate=&quot;</span> + createDate +</span><br><span class="line">                <span class="string">&quot;, updateDate=&quot;</span> + updateDate +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RoomTable是一个Entity类，对应数据库的表。字段类型要一致。关于Java类型和SQL的数据库表映射规则，请查阅官网。</p><hr><h3 id="插入一条数据并返回主键"><a href="#插入一条数据并返回主键" class="headerlink" title="插入一条数据并返回主键"></a>插入一条数据并返回主键</h3><p>我们新建的表RoomTable是有ID的，我们创建了一个Room后要知道生成的id，来返回给前端。不然前端不知道id就无法进行修改之类的操作了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsertAndGetKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> RoomTable room = <span class="keyword">new</span> RoomTable(<span class="string">&quot;Doule Bed&quot;</span>, <span class="string">&quot;no&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date());</span><br><span class="line">    <span class="keyword">final</span> KeyHolder keyHolder = <span class="keyword">new</span> GeneratedKeyHolder();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> update = jdbcTemplate.update((Connection con) -&gt; &#123;</span><br><span class="line">        <span class="keyword">final</span> String sql = <span class="string">&quot;INSERT INTO room(`name`, `comment`, `create_date`, `update_date`) VALUES (?,?,?,?)&quot;</span>;</span><br><span class="line">        PreparedStatement preparedStatement = con.prepareStatement(sql,</span><br><span class="line">                Statement.RETURN_GENERATED_KEYS);</span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, room.getName());</span><br><span class="line">        preparedStatement.setString(<span class="number">2</span>, room.getComment());</span><br><span class="line">        preparedStatement.setObject(<span class="number">3</span>, <span class="keyword">new</span> Timestamp(room.getCreateDate().getTime()));</span><br><span class="line">        preparedStatement.setObject(<span class="number">4</span>, <span class="keyword">new</span> Timestamp(room.getUpdateDate().getTime()));</span><br><span class="line">        <span class="keyword">return</span> preparedStatement;</span><br><span class="line">    &#125;, keyHolder);</span><br><span class="line">    System.out.println(<span class="string">&quot;The number of success:&quot;</span>+update);</span><br><span class="line">    System.out.println(<span class="string">&quot;The primary key of insert row: &quot;</span>+keyHolder.getKey().intValue());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(<span class="string">&quot;SELECT * FROM room&quot;</span>);</span><br><span class="line">    System.out.println(maps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><code>KeyHolder</code>用来接收自动生成的主键.</li><li><code>PreparedStatement</code>用来创建一个占位符的sql语句.</li><li>需要注意日期类型的映射规则，需要将java.util.Date转换为java.sql.*</li><li><code>queryForList</code>可以查询当前数据中的内容</li></ol><hr><h3 id="查询–findById"><a href="#查询–findById" class="headerlink" title="查询–findById"></a>查询–findById</h3><p>首先，修改下Date类型为datetime, 因为需要直到修改的具体时间。因此，room的scheme修改如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> springboot_demo <span class="keyword">charset</span> utf8 <span class="keyword">collate</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">use</span> springboot_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for room</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`room`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`room`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">80</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`comment`</span> <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`create_date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`update_date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">4</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of room</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`room`</span> <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;大床房&#x27;</span>, <span class="string">&#x27;无窗&#x27;</span>, <span class="string">&#x27;2017-11-26 00:00:00&#x27;</span>, <span class="string">&#x27;2017-11-26 00:00:00&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`room`</span> <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;Double Bed&#x27;</span>, <span class="string">&#x27;no&#x27;</span>, <span class="string">&#x27;2017-12-06 00:00:00&#x27;</span>, <span class="string">&#x27;2017-12-06 00:00:00&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`room`</span> <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;Big Bed&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;2017-12-06 00:00:00&#x27;</span>, <span class="string">&#x27;2017-12-06 10:00:00&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>默认添加3条记录。</p><p>在resources下新建schema.sql,填入上述内容。当springboot启动时，会自动加载这个sql。那么就会重新初始化数据库。</p><p>我们的测试类会真实启动springboot的，因此每个测试都会重新初始化数据库一遍。下面可以测试根据id查询内容。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;select `id`,`name`,`comment`,`create_date`,`update_date` from room WHERE id=?&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> RoomTable roomTable = jdbcTemplate.queryForObject(sql, (rs, rowNum) -&gt; <span class="keyword">new</span> RoomTable(rs.getInt(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;comment&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;create_date&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;update_date&quot;</span>)), <span class="number">3</span>);</span><br><span class="line">    System.out.println(roomTable);</span><br><span class="line">    Assert.assertTrue(<span class="number">3</span>== roomTable.getId());</span><br><span class="line">    Assert.assertNotNull(roomTable.getCreateDate());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>注意要使用select 字段列表来获取想要的字段，不要用<code>*</code></li><li><code>varchar</code>的映射为String</li><li><code>int</code>的映射为Integer</li><li><code>datetime</code>的映射为time</li><li>此处的映射为一个lambda表达式，从结果集中选择想要的字段来创建我们的映射关系</li><li>最后一个参数是占位符的值，防止sql注入。</li></ol><p>然后，可以观察到控制台重新启动springboot，并且运行了schema.sql。接下来需要注意的地方到了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoomTable&#123;id&#x3D;3, name&#x3D;&#39;Big Bed&#39;, comment&#x3D;&#39;&#39;, createDate&#x3D;08:00:00, updateDate&#x3D;18:00:00&#125;</span><br></pre></td></tr></table></figure><p>打印出查询的时间比我们插入的时间多了8h。很容易猜测到时区问题。因为我们是北京时间，<code>UTC+8</code>。所以，在从数据库中取出时间的时候，做了下时区转换。我们的项目把数据的时区当作是<code>UTC</code>了。事实上，在生产环境中确实应该把数据库的时区设置为<code>UTC</code>。因为我们是全球性的项目。当然，设置为<code>UTC+8</code>也是可以的。但为了防止困扰，设置为<code>UTC</code>是最佳选择。</p><p>然而，真正的问题还不是这个。我们数据库当前的timezone是多少？</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  show variables like &#x27;%time_zone%&#x27;;</span><br><span class="line">+<span class="comment">------------------+--------+</span></span><br><span class="line">| Variable_name    | Value  |</span><br><span class="line">+<span class="comment">------------------+--------+</span></span><br><span class="line">| system_time_zone |        |</span><br><span class="line">| time_zone        | SYSTEM |</span><br><span class="line">+<span class="comment">------------------+--------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>系统时区，显然应该是北京时间，即<code>UTC+8</code>的。那么，我们为什么查询的时候会把数据库当作0时区呢？</p><p>因为Java里的北京时间对应的时区为<code>Asia/Shanghai</code>,修改配置文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;springboot_demo?serverTimezone&#x3D;Asia&#x2F;Shanghai&amp;characterEncoding&#x3D;utf-8</span><br></pre></td></tr></table></figure><p>然后，重新运行测试。结果正常了。此时，我们的项目时区为系统时区，我们的数据时区为系统时区。我们连接的驱动转换也标记了数据库为北京时间。这样就不会出现时区问题。如果是生产环境，就要把数据库/服务器/驱动参数设置为<code>UTC</code>.</p><hr><h3 id="查询返回list"><a href="#查询返回list" class="headerlink" title="查询返回list"></a>查询返回list</h3><p>除了最常用的findbyId, 最常用的查询是返回一个list。因为我们的搜索是返回条件匹配的值，而匹配条件的item通常很多个，即list。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;select `id`,`name`,`comment`,`create_date`,`update_date` from room WHERE id&gt;? LIMIT 0,2&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> List&lt;RoomTable&gt; roomTableList = jdbcTemplate.query(sql, (rs, rowNum) -&gt; <span class="keyword">new</span> RoomTable(rs.getInt(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;comment&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;create_date&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;update_date&quot;</span>)), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(roomTableList);</span><br><span class="line">    assertEquals(<span class="number">2</span>, roomTableList.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>同样要做结果集映射</li><li>同样需要传入占位符value</li><li>返回值是一个list</li></ol><hr><h3 id="删除一条数据"><a href="#删除一条数据" class="headerlink" title="删除一条数据"></a>删除一条数据</h3><p>删除一条数据就是把这条记录给删除掉。<br>删除一条数据这个功能通常都有，但是，现在并不是把数据真正的删除。因为基于某种想恢复的可能或者某国法律要求，被删除的数据只是被隐藏，仍旧遗留在数据库中。在这里，先实现彻底删除一条记录：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;DELETE FROM room WHERE `id`=?&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> update = jdbcTemplate.update(sql, <span class="number">1</span>);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, update);</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(<span class="string">&quot;select id from room where `id`=?&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    Assert.assertTrue(maps.isEmpty());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> count = jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from room&quot;</span>, Integer.class);</span><br><span class="line">    Assert.assertEquals(<span class="number">2</span>, count);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>使用update方法，第二个参数为占位符value</li><li>返回一个count表明生效的数量，这里删除了一条，应该返回1</li><li>为了验证我们是否删除成功了。首先，我们每次会初始化数据库，数据库中只有初始化的3条记录。现在删除id为1的记录。应该剩下2条记录。还有就是查询id为1的数据的结果集是null.</li></ol><p>另外，由于jdbcTemplate查询的结果集为nul时，会抛出异常<code>EmptyResultDataAccessException</code> , 根据<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/18503607/best-practice-to-select-data-using-spring-jdbctemplate">stackoverflow</a>, 推荐捕获异常来确定结果集为null。于是，也可以这样判断数据是否被删除。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    jdbcTemplate.queryForObject(<span class="string">&quot;select id from room where `id`=?&quot;</span>, Integer.class, <span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (EmptyResultDataAccessException e) &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;Get a null result, the data is not exist in the database.&quot;</span>+e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="更新一条数据"><a href="#更新一条数据" class="headerlink" title="更新一条数据"></a>更新一条数据</h3><p>更新一条数据是基于查询条件唯一确定一条记录，然后更新该记录的某个或者多个属性。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;update room set `update_date`=?, `comment`=? where id=?&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> update = jdbcTemplate.update(sql, <span class="keyword">new</span> Object[]&#123;<span class="keyword">new</span> Date(), <span class="string">&quot;booked&quot;</span>, <span class="number">1</span>&#125;);</span><br><span class="line">    assertEquals(<span class="number">1</span>, update);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String getSql = <span class="string">&quot;select `id`,`name`,`comment`,`create_date`,`update_date` from room WHERE id=?&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> RoomTable roomTable = jdbcTemplate.queryForObject(getSql, (rs, rowNum) -&gt; <span class="keyword">new</span> RoomTable(rs.getInt(<span class="string">&quot;id&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">            rs.getString(<span class="string">&quot;comment&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;create_date&quot;</span>),</span><br><span class="line">            rs.getTimestamp(<span class="string">&quot;update_date&quot;</span>)), <span class="number">1</span>);</span><br><span class="line">    System.out.println(roomTable);</span><br><span class="line">    assertEquals(<span class="string">&quot;booked&quot;</span>, roomTable.getComment());</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到控制台打印的更新时间：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RoomTable&#123;id&#x3D;1, name&#x3D;&#39;大床房&#39;, comment&#x3D;&#39;booked&#39;, createDate&#x3D;00:00:00, updateDate&#x3D;22:23:18&#125;</span><br></pre></td></tr></table></figure><ol><li>注意update的sql语法，我之前就是把逗号写成了<code>and</code>总是报错。</li><li>注意占位符的匹配，按顺序填充value。</li><li>更新成功应该返回1</li></ol><p>之前提到，删除操作通常并非真实的删除一条记录。而是设置一个flag，通过判断flag来确定是否有效。</p><p>修改room的表，增加一个字段<code>active</code>.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table room add column `active` tinyint default 0 not null;            </span><br><span class="line">Query OK, 0 rows affected (0.16 sec)                                               </span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0                                             </span><br><span class="line">                                                                                   </span><br><span class="line">                      </span><br><span class="line">mysql&gt; desc room;                                                                  </span><br><span class="line">+<span class="comment">-------------+--------------+------+-----+---------+----------------+             </span></span><br><span class="line">| Field       | Type         | Null | Key | Default | Extra          |             </span><br><span class="line">+<span class="comment">-------------+--------------+------+-----+---------+----------------+             </span></span><br><span class="line">| id          | int(11)      | NO   | PRI | NULL    | auto_increment |             </span><br><span class="line">| name        | varchar(80)  | NO   |     | NULL    |                |             </span><br><span class="line">| <span class="keyword">comment</span>     | <span class="built_in">varchar</span>(<span class="number">200</span>) | YES  |     | <span class="literal">NULL</span>    |                |             </span><br><span class="line">| create_date | datetime     | <span class="keyword">NO</span>   |     | <span class="literal">NULL</span>    |                |             </span><br><span class="line">| update_date | datetime     | <span class="keyword">NO</span>   |     | <span class="literal">NULL</span>    |                |             </span><br><span class="line">| active      | <span class="built_in">tinyint</span>(<span class="number">4</span>)   | <span class="keyword">NO</span>   |     | <span class="number">0</span>       |                |             </span><br><span class="line">+<span class="comment">-------------+--------------+------+-----+---------+----------------+             </span></span><br><span class="line"><span class="number">6</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)                                                           </span><br><span class="line">                                                                                   </span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> room;                                                                           </span><br><span class="line">+<span class="comment">----+------------+---------+---------------------+---------------------+--------+ </span></span><br><span class="line">| id | name       | <span class="keyword">comment</span> | create_date         | update_date         | active | </span><br><span class="line">+<span class="comment">----+------------+---------+---------------------+---------------------+--------+ </span></span><br><span class="line">|  <span class="number">1</span> | 大床房     | 无窗    | <span class="number">2017</span><span class="number">-11</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | <span class="number">2017</span><span class="number">-11</span><span class="number">-26</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> |      <span class="number">0</span> |      </span><br><span class="line">|  <span class="number">2</span> | <span class="keyword">Double</span> Bed | <span class="keyword">no</span>      | <span class="number">2017</span><span class="number">-12</span><span class="number">-06</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | <span class="number">2017</span><span class="number">-12</span><span class="number">-06</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> |      <span class="number">0</span> | </span><br><span class="line">|  <span class="number">3</span> | <span class="keyword">Big</span> Bed    |         | <span class="number">2017</span><span class="number">-12</span><span class="number">-06</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> | <span class="number">2017</span><span class="number">-12</span><span class="number">-06</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">00</span> |      <span class="number">0</span> | </span><br><span class="line">+<span class="comment">----+------------+---------+---------------------+---------------------+--------+ </span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)                                                           </span><br><span class="line">                                                                                   </span><br></pre></td></tr></table></figure><ol><li><code>ALTER TABLE table_name ADD column_name datatype</code> 为修改表，并增加一个field。</li><li><code>ALTER TABLE table_name DROP COLUMN column_name</code> 为修改表，并删除一个field。</li><li><code>ALTER TABLE table_name ALTER COLUMN column_name datatype</code>为修改表，并更改一个field。</li><li><code>tinyint</code> 表示从 0 到 255 的整型数据。存储大小为 1 字节。</li><li><code>desc tableName</code>为查看表结构。</li><li>看可以看到表结构已经改变，并且给active设置了默认值0，那么当需要删除时，设置为1.</li></ol><p>下面，当接到一个删除的需求时，我们设置active为1. 需要注意，由于每次测试都会重新覆盖数据库，需要将修改的sql放入schama.sql.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateForDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;update room set `update_date`=?, `active`=1 where id=?&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> update = jdbcTemplate.update(sql, <span class="keyword">new</span> Object[]&#123;<span class="keyword">new</span> Date(), <span class="number">1</span>&#125;);</span><br><span class="line">    Assert.assertEquals(<span class="number">1</span>, update);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> String getSql = <span class="string">&quot;select `active` from room WHERE id=?&quot;</span>;</span><br><span class="line">    Integer active = jdbcTemplate.queryForObject(getSql, Integer.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(active);</span><br><span class="line">    Assert.assertTrue(active == <span class="number">1</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="批量添加-更新数据"><a href="#批量添加-更新数据" class="headerlink" title="批量添加/更新数据"></a>批量添加/更新数据</h3><p>有时候需要批量添加一些数据，比如导入数据。这时候每条都执行一次sql就会显得很慢。这里提供了batch方法，可以一次同时插入多条数据。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchInsert</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ArrayList&lt;RoomTable&gt; rooms = Lists.newArrayList(</span><br><span class="line">            <span class="keyword">new</span> RoomTable(<span class="string">&quot;name1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date()),</span><br><span class="line">            <span class="keyword">new</span> RoomTable(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date()),</span><br><span class="line">            <span class="keyword">new</span> RoomTable(<span class="string">&quot;name3&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date())</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;INSERT INTO room(`name`, `comment`, `create_date`, `update_date`) VALUES (?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(sql, <span class="keyword">new</span> BatchPreparedStatementSetter() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValues</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">            <span class="keyword">final</span> RoomTable roomTable = rooms.get(i);</span><br><span class="line">            ps.setString(<span class="number">1</span>, roomTable.getName());</span><br><span class="line">            ps.setString(<span class="number">2</span>, roomTable.getComment());</span><br><span class="line">            ps.setTimestamp(<span class="number">3</span>, <span class="keyword">new</span> java.sql.Timestamp(roomTable.getCreateDate().getTime()));</span><br><span class="line">            ps.setTimestamp(<span class="number">4</span>, <span class="keyword">new</span> java.sql.Timestamp(roomTable.getUpdateDate().getTime()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBatchSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> rooms.size();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> anInt : ints) &#123;</span><br><span class="line">        assertEquals(<span class="number">1</span>, anInt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> count = jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from room&quot;</span>, Integer.class);</span><br><span class="line">    assertEquals(<span class="number">6</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>需要有一个list来存储批量数据</li><li>调用batchUpdate方法即可，注意占位符的顺序</li><li>注意batch 的size</li></ol><p>同时，提供了数组版本：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchInert2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">final</span> String sql = <span class="string">&quot;INSERT INTO room(`name`, `comment`, `create_date`, `update_date`) VALUES (?,?,?,?)&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(sql,</span><br><span class="line">            Lists.newArrayList(</span><br><span class="line">                    <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;name1&quot;</span>, <span class="string">&quot;这是一条数据&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date()&#125;,</span><br><span class="line">                    <span class="keyword">new</span> Object[]&#123;<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;这是另一条数据的value&quot;</span>, <span class="keyword">new</span> Date(), <span class="keyword">new</span> Date()&#125;));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> anInt : ints) &#123;</span><br><span class="line">        assertEquals(<span class="number">1</span>, anInt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>同样需要使用占位符</li><li>把需要批量的数据组成一个list，每个元素又是数组，数组的内容为一条数据的占位符value</li></ol><hr><h3 id="批量删除数据"><a href="#批量删除数据" class="headerlink" title="批量删除数据"></a>批量删除数据</h3><p>同理。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBatchDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span>[] ints = jdbcTemplate.batchUpdate(<span class="string">&quot;DELETE FROM room WHERE id=?&quot;</span>, Lists.newArrayList(<span class="keyword">new</span> Object[]&#123;<span class="number">1</span>&#125;, <span class="keyword">new</span> Object[]&#123;<span class="number">2</span>&#125;, <span class="keyword">new</span> Object[]&#123;<span class="number">3</span>&#125;));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> anInt : ints) &#123;</span><br><span class="line">        assertEquals(<span class="number">1</span>, anInt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> count = jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from room&quot;</span>, Integer.class);</span><br><span class="line">    assertEquals(<span class="number">0</span>, count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="分层架构"><a href="#分层架构" class="headerlink" title="分层架构"></a>分层架构</h2><p>代码的数量随着业务会越积越多，为了能够更容易开发，更容易维护，有许多规范需要遵守。最基本就是分层架构。</p><p>Domain Driven Design的主旨是模块化，模块内聚，模块间低耦合。只有分的开，互不相干，才能更好的维护，编写代码才能更轻松。DDD里的分层如下：<br><img src="https://images2017.cnblogs.com/blog/686418/201712/686418-20171218221518865-254833322.png"></p><p>这是一个整体的层次划分，落实到我们的代码上，则通常分为3层： controller， service， dao。</p><p><img src="https://images2017.cnblogs.com/blog/686418/201712/686418-20171218223806178-819790245.jpg"></p><p>controller调用service，service调用dao。</p><p>controller负责路由分发。</p><p>service负责业务逻辑处理。</p><p>dao曾则是持久化层，服务对象和数据的持久化存储。通常是存入数据库。</p><h3 id="实体entity"><a href="#实体entity" class="headerlink" title="实体entity"></a>实体entity</h3><p>在DDD里，重要的就是领域模型，上述的分层架构只是为了能让模型间的交互更加清晰，那么模型该如何定义？ 侠义的理解，我们可以把一个Java bean当作一个model，当作一个领域模型。再具体的讲，和数据库表做映射的类，可以当作是领域对象。领域对象即entity，所以，在我们的架构里会有个<br>entity的packag，用来存放领域对象。领域对象也给显著的特征是 <strong>有唯一性id</strong> ， 通过唯一性id可以区分不同entity。</p><h3 id="值对象valueobject"><a href="#值对象valueobject" class="headerlink" title="值对象valueobject"></a>值对象valueobject</h3><p>与entity相关的是值对象，即valueobject。值对象，即存储值的对象。DTO可以说是一种值对象，值对象是在数据传输过程中使用的对象。因为数据传输过程中<br>可能会执行对象的方法，调用对象的属性，甚至只需要领域对象的部分数据。所以不能直接讲领域对象entity传输出来，而要使用值对象。值对象的一个显著特征<br>是 <strong>不可变</strong>，构造的值对象最好要设置为不可变更的。值对象对id没有要求。</p><h3 id="面向接口编程"><a href="#面向接口编程" class="headerlink" title="面向接口编程"></a>面向接口编程</h3><p>Java中的接口可以通过子类向上转型来代理实现类。interface只需要顶以好行为，然后就可以被调用。调用者只需要直到接口入参和返回值以及目的就可以了，完全<br>不用甚至不应该理会接口内部的实现，如此可以将业务逻辑隔离开来，降低耦合性。所以， <strong>分层调用必须使用面向接口变成</strong>。</p><p>对应到我们的具体代码上，则应该<code>controller</code>调用<code>IService</code>, <code>IService</code>调用<code>IDao</code>。而<code>serviceimpl</code>之类的实现类不应和调用者产生联系。</p><h3 id="一个简单的demo"><a href="#一个简单的demo" class="headerlink" title="一个简单的demo"></a>一个简单的demo</h3><p>清楚上述的几个概念后，就可以理解接下来的做法了。我们从下往上，依次建立我们需要的类。</p><p>首先，是DAO层。我们需要一个用户表来存储用户信息，新建一个user表。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> springboot_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span>(</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">VARCHAR</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span>,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">12</span>),</span><br><span class="line">  <span class="string">`create_date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`update_date`</span> datetime <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">4</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure><ol><li>id是必须的，简单设置为自增，主键。</li><li>username是用户的账号，用户登录账号要唯一，所以设置为<code>UNIQUE</code>，同时必然可以为null。</li><li>name长度设置为12个字符以内。</li><li>创建时间和更新时间必须。</li></ol><p>然后，创建dao层。dao层需要和数据库交互，则必须要一个entity来存储数据，于是需要先新建一个entity。新建<code>com.test.demo.domain.entity.UserTable</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.domain.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan Miao(http://www.cnblogs.com/woshimrf/)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserTable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">    <span class="keyword">private</span> Date updateDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserTable</span><span class="params">(String username, String name, Date createDate, Date updateDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">        <span class="keyword">this</span>.updateDate = updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateDate</span><span class="params">(Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getUpdateDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> updateDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdateDate</span><span class="params">(Date updateDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.updateDate = updateDate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后，创建我们的Dao， <code>com.test.demo.domain.dao.IUserDao</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.domain.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.test.demo.domain.entity.UserTable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan Miao(http://www.cnblogs.com/woshimrf/)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个用户。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userTable user信息，id将被忽略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> id。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insert</span><span class="params">(UserTable userTable)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户by id。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserTable <span class="title">getById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>实现类先暂停，继续上一层，service层。新建``, 目标依旧是创建和获取用户。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test.demo.domain.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.test.demo.domain.entity.UserTable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Ryan Miao(http://www.cnblogs.com/woshimrf/)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">IUserService</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个用户。</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userTable user信息，id将被忽略</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> id。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insert</span><span class="params">(UserTable userTable)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户by id。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserTable <span class="title">getById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>到这里，你会发现，这两个接口明明一模一样，除了名字。是的，在一定程度来说，这两个抽象的接口的行为很相似，但从分层的理念上看，含义是不同的。我也是过了很久才体会到这种分层的好处的。分层可以把业务逻辑和数据处理隔离开来，这个demo里业务简单，所以看着相似，但事实上，service层要处理更多的业务逻辑，即实现层是不同的。service层也不仅仅是一个转发。</p><p>有了service层，那么可以在controller里调用了。新建<code>com.test.demo.controller.UserController</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.test.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.test.demo.domain.entity.UserTable;</span><br><span class="line"><span class="keyword">import</span> com.test.demo.domain.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/v1/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IUserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserTable <span class="title">getUserById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">insertUser</span><span class="params">(<span class="meta">@RequestBody</span> UserTable userTable)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userService.insert(userTable);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li><code>@RestController</code>仍旧当作一个rest接口，即只是API，返回json数据。</li><li><code>@RequestMapping(&quot;/api/v1/users&quot;)</code> 定义我们的资源前缀和版本号</li><li><code>@Autowired private IUserService userService;</code> 获取我们的User service， <code>@Autowired</code>是spring容器里自动注入的注解，作用是帮忙生成一定对象，并赋值给它。这里即获得一个<code>IUserService</code>对象。但是，在IDEA里，你会看到编译器报警，红色的波浪线，<code>Could not autowired</code>。 是指我们要注入一个<code>IUserService</code>实例，但我们并没有提供给它，它也就没办法找到并帮忙注入了。也就是说，我们的代码还不能用。还需要一个实例。一种做法是，像我们之前声明<code>JdbcTemplate</code>一样，声明一个出来。但前提是我们有这个class可以new，目前是我们只有接口，所以还需要创建它的实现类。</li></ol><p>&lt;未完待续！&gt;</p><p>新建，``</p><h2 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h2><p>JPA是Java Persistence API的简称。</p><p>相比jdbcTemplate, 需要写sql，需要做映射。JPA提供了一个规范，即通常这样写，我给封装好，你就这样调用即可。</p><p>以下参考官方文档以及<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ityouknow/p/5891443.html%E3%80%82">https://www.cnblogs.com/ityouknow/p/5891443.html。</a></p><h3 id="引入JPA"><a href="#引入JPA" class="headerlink" title="引入JPA"></a>引入JPA</h3><p>添加依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">compile(&quot;org.springframework.boot:spring-boot-starter-data-jpa&quot;)</span><br><span class="line">testCompile group: &#39;com.h2database&#39;, name: &#39;h2&#39;, version: &#39;1.4.196&#39;</span><br></pre></td></tr></table></figure><ol><li>这个jpa会包含所有需要引用的依赖，注意，之前已经引入了MySQL，因此还是需要引入MySQL驱动的，不然无法自动检测究竟使用的是哪个数据库</li><li>这个h2是用来搞测试的。之前的测试全都是针对真实数据库的。在后面我们会引入自动化测试，自动化测试会跑无数遍，肯定不能用真实的数据库来测试代码逻辑的准确。因此，引入h2. h2是一个内存数据库，Java编写的。可以兼容MySQL。后面，我们跑测试用例的时候，就会使用h2作为数据库，而不是真实的MySQL。</li></ol><h3 id="修改和标注我们的实体类"><a href="#修改和标注我们的实体类" class="headerlink" title="修改和标注我们的实体类"></a>修改和标注我们的实体类</h3><p>这里的JPA是基于注解来实现的。因此，我们需要标注实体类。</p><h2 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h2><h2 id="面向接口编程-1"><a href="#面向接口编程-1" class="headerlink" title="面向接口编程"></a>面向接口编程</h2><h2 id="编写测试"><a href="#编写测试" class="headerlink" title="编写测试"></a>编写测试</h2><h2 id="集成CI"><a href="#集成CI" class="headerlink" title="集成CI"></a>集成CI</h2><h2 id="登陆拦截"><a href="#登陆拦截" class="headerlink" title="登陆拦截"></a>登陆拦截</h2><h2 id="OAuth2-0"><a href="#OAuth2-0" class="headerlink" title="OAuth2.0"></a>OAuth2.0</h2><h2 id="事物"><a href="#事物" class="headerlink" title="事物"></a>事物</h2><h2 id="JPA-1"><a href="#JPA-1" class="headerlink" title="JPA"></a>JPA</h2><h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h2 id="远程调用"><a href="#远程调用" class="headerlink" title="远程调用"></a>远程调用</h2><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a target="_blank" rel="noopener" href="https://codeplanet.io/principles-good-restful-api-design/">https://codeplanet.io/principles-good-restful-api-design/</a></li><li><a target="_blank" rel="noopener" href="https://github.com/aisuhua/restful-api-design-references">https://github.com/aisuhua/restful-api-design-references</a></li><li><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/5659e6e16115">http://www.jianshu.com/p/5659e6e16115</a></li><li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/28557115">https://www.zhihu.com/question/28557115</a></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span> <span class="post-copyright-info"><a href="mailto:undefined">Ryan Miao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span> <span class="post-copyright-info"><a href="http://blog.rmiao.top/2017/11/12/Hello-Java-Web/">http://blog.rmiao.top/2017/11/12/Hello-Java-Web/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span> <span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.rmiao.top" target="_blank">Ryan Miao的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/11/12/how-to-debug-nodejs-with-visualstudio-code/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">如何使用visual studio code debug node js</div></div></a></div><div class="next-post pull-right"><a href="/2017/10/24/hello-dagger/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Dagger2 入门解析</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i> <span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2018/02/28/ArrayList/" title="ArrayList源码阅读"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-02-28</div><div class="title">ArrayList源码阅读</div></div></a></div><div><a href="/2017/09/12/Java-ArrayList-remove/" title="Java中ArrayList remove会遇到的坑"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-09-12</div><div class="title">Java中ArrayList remove会遇到的坑</div></div></a></div><div><a href="/2017/09/29/filter-two-list/" title="如何从两个List中筛选出相同的值"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-09-29</div><div class="title">如何从两个List中筛选出相同的值</div></div></a></div><div><a href="/2018/02/27/hashmap/" title="HashMap原理概述"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-02-27</div><div class="title">HashMap原理概述</div></div></a></div><div><a href="/2018/07/07/java-class/" title="Java复习2-对象与类"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-07</div><div class="title">Java复习2-对象与类</div></div></a></div><div><a href="/2018/07/06/java-data-type/" title="Java复习1-数据类型"><img class="cover" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2018-07-06</div><div class="title">Java复习1-数据类型</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/avatar.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"><div class="author-info__name">Ryan Miao</div><div class="author-info__description">技术总结</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">95</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">62</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">44</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Ryan-Miao"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/ryan-miao" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:woshimrf@126.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://www.cnblogs.com/woshimrf/" target="_blank" title="cnblogs"><i class="fas fa-folder"></i></a><a class="social-icon" href="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/wechar.jpg" target="_blank" title="miaoxingzhe"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/gongzhonghao.jpg" target="_blank" title="Ryan Miao的博客"><i class="iconfont icon-gongzhonghao"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">emm, 落後就要捱打。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">Java基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web"><span class="toc-number">3.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RESTfull-API"><span class="toc-number">3.1.</span> <span class="toc-text">RESTfull API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ContentType"><span class="toc-number">3.2.</span> <span class="toc-text">ContentType</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NodeJS-Web"><span class="toc-number">3.3.</span> <span class="toc-text">NodeJS Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java-Web"><span class="toc-number">3.4.</span> <span class="toc-text">Java Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#demo-source"><span class="toc-number">3.5.</span> <span class="toc-text">demo source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gradle%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">3.6.</span> <span class="toc-text">Gradle是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IntelIj-IDEA"><span class="toc-number">3.7.</span> <span class="toc-text">IntelIj IDEA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAgradle%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.8.</span> <span class="toc-text">新建一个gradle项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E7%BC%96%E5%86%99%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%85%8D%E7%BD%AE"><span class="toc-number">3.9.</span> <span class="toc-text">开始编写服务端配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E7%AC%AC%E4%B8%80%E4%B8%AAAPI"><span class="toc-number">3.10.</span> <span class="toc-text">编写第一个API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%92%8C%E8%B0%83%E8%AF%95"><span class="toc-number">3.11.</span> <span class="toc-text">启动和调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.12.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E5%8F%82%E6%95%B0%EF%BC%8C%E5%93%8D%E5%BA%94JSON"><span class="toc-number">3.13.</span> <span class="toc-text">接收参数，响应JSON</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E4%B8%BAJSON"><span class="toc-number">3.13.1.</span> <span class="toc-text">参数为JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E6%94%B6%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0"><span class="toc-number">3.13.2.</span> <span class="toc-text">接收数组参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C"><span class="toc-number">3.14.</span> <span class="toc-text">参数校验</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="toc-number">3.15.</span> <span class="toc-text">静态文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6"><span class="toc-number">3.16.</span> <span class="toc-text">模板文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F"><span class="toc-number">3.17.</span> <span class="toc-text">跨域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">3.18.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5MySQL-MariaDB"><span class="toc-number">3.19.</span> <span class="toc-text">引入MySQL&#x2F;MariaDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">3.19.1.</span> <span class="toc-text">安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">3.19.2.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#database"><span class="toc-number">3.19.3.</span> <span class="toc-text">database</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">3.19.4.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">3.19.5.</span> <span class="toc-text">插入一条记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E8%AE%B0%E5%BD%95"><span class="toc-number">3.19.6.</span> <span class="toc-text">查看所有记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">3.19.7.</span> <span class="toc-text">更新一条记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%80%E6%9D%A1%E8%AE%B0%E5%BD%95"><span class="toc-number">3.19.8.</span> <span class="toc-text">删除一条记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E5%8F%A5"><span class="toc-number">3.19.9.</span> <span class="toc-text">什么是数据操纵语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E8%BF%9E%E6%8E%A5MySQL"><span class="toc-number">3.20.</span> <span class="toc-text">项目连接MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JDBCTemplate"><span class="toc-number">3.21.</span> <span class="toc-text">JDBCTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">3.21.1.</span> <span class="toc-text">插入一条数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E5%B9%B6%E8%BF%94%E5%9B%9E%E4%B8%BB%E9%94%AE"><span class="toc-number">3.21.2.</span> <span class="toc-text">插入一条数据并返回主键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E2%80%93findById"><span class="toc-number">3.21.3.</span> <span class="toc-text">查询–findById</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E8%BF%94%E5%9B%9Elist"><span class="toc-number">3.21.4.</span> <span class="toc-text">查询返回list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">3.21.5.</span> <span class="toc-text">删除一条数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE"><span class="toc-number">3.21.6.</span> <span class="toc-text">更新一条数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%B7%BB%E5%8A%A0-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">3.21.7.</span> <span class="toc-text">批量添加&#x2F;更新数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.21.8.</span> <span class="toc-text">批量删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-number">3.22.</span> <span class="toc-text">分层架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93entity"><span class="toc-number">3.22.1.</span> <span class="toc-text">实体entity</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%80%BC%E5%AF%B9%E8%B1%A1valueobject"><span class="toc-number">3.22.2.</span> <span class="toc-text">值对象valueobject</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B"><span class="toc-number">3.22.3.</span> <span class="toc-text">面向接口编程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84demo"><span class="toc-number">3.22.4.</span> <span class="toc-text">一个简单的demo</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JPA"><span class="toc-number">3.23.</span> <span class="toc-text">JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E5%85%A5JPA"><span class="toc-number">3.23.1.</span> <span class="toc-text">引入JPA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E5%92%8C%E6%A0%87%E6%B3%A8%E6%88%91%E4%BB%AC%E7%9A%84%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-number">3.23.2.</span> <span class="toc-text">修改和标注我们的实体类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DI"><span class="toc-number">3.24.</span> <span class="toc-text">DI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E6%8E%A5%E5%8F%A3%E7%BC%96%E7%A8%8B-1"><span class="toc-number">3.25.</span> <span class="toc-text">面向接口编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95"><span class="toc-number">3.26.</span> <span class="toc-text">编写测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E6%88%90CI"><span class="toc-number">3.27.</span> <span class="toc-text">集成CI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E9%99%86%E6%8B%A6%E6%88%AA"><span class="toc-number">3.28.</span> <span class="toc-text">登陆拦截</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OAuth2-0"><span class="toc-number">3.29.</span> <span class="toc-text">OAuth2.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E7%89%A9"><span class="toc-number">3.30.</span> <span class="toc-text">事物</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JPA-1"><span class="toc-number">3.31.</span> <span class="toc-text">JPA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98"><span class="toc-number">3.32.</span> <span class="toc-text">缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8"><span class="toc-number">3.33.</span> <span class="toc-text">远程调用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/04/15/OAuth2.0%E7%90%86%E8%A7%A3%E5%92%8C%E7%94%A8%E6%B3%95/" title="OAuth2.0理解和用法"><img src="https://www.bing.com/th?id=OHR.AlbertaTrunks_ZH-CN6124025876_UHD.jpg&amp;pid=hp&amp;w=3840&amp;h=2160&amp;rs=1&amp;c=4&amp;r=0" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="OAuth2.0理解和用法"></a><div class="content"><a class="title" href="/2021/04/15/OAuth2.0%E7%90%86%E8%A7%A3%E5%92%8C%E7%94%A8%E6%B3%95/" title="OAuth2.0理解和用法">OAuth2.0理解和用法</a><time datetime="2021-04-15T14:04:40.000Z" title="发表于 2021-04-15 22:04:40">2021-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/18/%E7%AE%97%E6%B3%95/2.LRU%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/" title="LRU算法实现"><img src="https://cn.bing.com/th?id=OHR.MtEtna_ZH-CN9127683040_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=3840&amp;h=2160&amp;rs=1&amp;c=4" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="LRU算法实现"></a><div class="content"><a class="title" href="/2021/03/18/%E7%AE%97%E6%B3%95/2.LRU%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0/" title="LRU算法实现">LRU算法实现</a><time datetime="2021-03-18T15:44:40.000Z" title="发表于 2021-03-18 23:44:40">2021-03-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/03/11/%E7%AE%97%E6%B3%95/1.%E5%8D%95%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/" title="单链表和反转"><img src="https://cn.bing.com/th?id=OHR.LyonAstronomical_ZH-CN8601552487_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=3840&amp;h=2160&amp;rs=1&amp;c=4" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="单链表和反转"></a><div class="content"><a class="title" href="/2021/03/11/%E7%AE%97%E6%B3%95/1.%E5%8D%95%E9%93%BE%E8%A1%A8%E5%8F%8D%E8%BD%AC/" title="单链表和反转">单链表和反转</a><time datetime="2021-03-11T15:44:40.000Z" title="发表于 2021-03-11 23:44:40">2021-03-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2020/11/11/java-synchronized/" title="Java基础之Synchronized原理"><img src="https://cn.bing.com/th?id=OHR.EsskastanieD_ZH-CN9736686128_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=2880&amp;h=1620&amp;rs=1&amp;c=4" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Java基础之Synchronized原理"></a><div class="content"><a class="title" href="/2020/11/11/java-synchronized/" title="Java基础之Synchronized原理">Java基础之Synchronized原理</a><time datetime="2020-11-11T12:46:40.000Z" title="发表于 2020-11-11 20:46:40">2020-11-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2018/07/10/java-class-inheritance/" title="Java复习3-类的继承"><img src="https://cn.bing.com/th?id=OHR.LakotaBadlands_ZH-CN0151830089_UHD.jpg&amp;rf=LaDigue_UHD.jpg&amp;pid=hp&amp;w=2880&amp;h=1620&amp;rs=1&amp;c=4" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Java复习3-类的继承"></a><div class="content"><a class="title" href="/2018/07/10/java-class-inheritance/" title="Java复习3-类的继承">Java复习3-类的继承</a><time datetime="2018-07-10T11:58:14.000Z" title="发表于 2018-07-10 19:58:14">2018-07-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/Ryan-Miao/ryan-miao.github.io/image/default_cover.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Ryan Miao</div><div class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div></div><hr><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '50b74dddd9c8deff00e9',
      clientSecret: 'b61654c092fbd8ab7ff6c4d0078b671b62211e23',
      repo: 'gitalk',
      owner: 'ryanmiao2',
      admin: ['ryanmiao2'],
      id: '86697a234cf065c3363abfe691be41d6',
      language: 'zh-CN',
      perPage: 10,
      distractionFreeMode: false,
      pagerDirection: 'last',
      createIssueManually: false,
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !false) {
  if (false) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,POWERMODE.mobile=!1,document.body.addEventListener("input",POWERMODE)</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="开心,美丽,大方,正直,原则,可爱,坚韧,靠谱,斜杠青年,幸运,善良,你真棒" data-fontsize="15px" data-random="false" async></script><script>function chatBtnHide(){document.getElementsByClassName("gitter-open-chat-button")[0].style.display="none"}function chatBtnShow(){document.getElementsByClassName("gitter-open-chat-button")[0].style.display="block"}((window.gitter={}).chat={}).options={room:"Ryan-Miao/blog"}</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>